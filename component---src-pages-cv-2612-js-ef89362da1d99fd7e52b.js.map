{"version":3,"sources":["webpack:///./src/layouts/cv2612.js","webpack:///./src/components/cv2612/utils/patches-utils.js","webpack:///./src/components/cv2612/utils/ym2612.js","webpack:///./src/components/cv2612/utils/emulator.js","webpack:///./src/components/cv2612/context.js","webpack:///./src/components/cv2612/midi.js","webpack:///./src/components/cv2612/sequencer.js","webpack:///./src/components/cv2612/patches.js","webpack:///./src/components/cv2612/envelope.js","webpack:///./src/components/cv2612/slider.js","webpack:///./src/components/cv2612/operator.js","webpack:///./src/components/cv2612/channel.js","webpack:///./src/components/cv2612/utils/algorithmAscii.js","webpack:///./src/components/cv2612/channels.js","webpack:///./src/components/cv2612/device.js","webpack:///./src/pages/cv2612.js","webpack:///./.cache/gatsby-browser-entry.js","webpack:///./.cache/public-page-renderer.js","webpack:///./src/components/seo.js","webpack:///./.cache/public-page-renderer-prod.js","webpack:///./src/components/header/brand.js"],"names":["Layout","render","children","this","props","react_default","a","createElement","id","Helmet_default","bodyAttributes","class","brand","title","React","Component","dmp2patch","name","d","params","ch","op","o","replace","emptyParams","bitness","param","bits","_i","_groups","length","some","k","endsWith","console","log","emptyMapping","mapping","key","cc","YM2612","version","start","count","chip","Y","cfg","hq_fm","dac_bits","maxcalc","debug","debugLocal","debugArr","mode","strict","_YM","FREQ_SH","EG_SH","LFO_SH","TIMER_SH","FREQ_MASK","_ENV","BITS","MIN_ATT_INDEX","LEN","STEP","MAX_ATT_INDEX","_EG","ATT","DEC","SUS","REL","OFF","_DT","MASK","_SIN","SC","O","_TL","RES_LEN","TAB_LEN","tab","Array","QUIET","sin","sl","db","RATE_STEPS","inc","rate_select","rate_shift","OPN","fktable","LFO","samples_per_step","ams_depth_shift","pm_output","pm_table","CHAN","N","SLOT","op_calc","_SLOT","FM_SLOT","_eg","ar","d1r","d2r","rr","init","DT","KSR","rate","ksr","mul","toString","join","phase","Incr","state","tl","volume","vol_out","eg","sh","sel","ssg","ssgn","AMmask","reset","out","dt1mul","dt1","ksar","ks","amd1r","am","slrr","FM_CH","ALGO","FB","op1_out","connect","mem","value","pms","ams","fc","kcode","block_fnum","fn_h","outputs","m1","m2","c1","c2","x","canCSM","canDAC","muted","pan","s","FM_ST","c","r","address","status","timer_base","TA","TAL","TAC","TB","TBL","TBC","dt_tab","clock","FM_3SLOT","key_csm","FM_OPN","_timer","cnt","timer","timer_add","timer_overflow","ST","SL3","lfo","AM","PM","fn","table","max","YMX","CH","dacen","dacout","INTERNAL_TIMER_A","keyControlCSM","set_timers","v","keyOffCSM","advance_eg_channels","eg_cnt","i","advance_eg","bitmask","prototype","keyOn","csm","keyOff","keyOnCSM","setupConnection","Error","set_det_mul","set_tl","set_ar_ksr","old_ksr","q","set_dr","set_sr","set_sl_rr","j","update_ssg_eg","update_phase_lfo","off","blk","kc","update_phase_lfo_precalc","finc","refresh_fc_eg","calcVol","env","pm","fb","p","calculate","inp","asFB","eg_out","val","outs","WriteMode","WriteReg","S","SetPrescaler","ratio","scale","z","interval","ym","n","m","PI","Math","LOG","POW","pow","SIN","tmp","rl2","init_tables","num","reset_channels","write","addr","read","update","len","lt","rt","dis_csm","buf","is_csm","didDac","_upd","CL","step","INTERNAL_TIMER_B","config","toggle","load","save","kb","AudioKeys","polyphony","rows","priority","notes","Emulator","_this","noteOn","note","f","onKeyDown","frequency","noteOff","onKeyUp","indexOf","push","block","freq","parseInt","splice","down","up","window","fm","Sound","source","options","audioFunction","e","buffer","output","outputBuffer","getChannelData","bufferSize","play","pause","destroy","stop","mask","size","shift","CV2612Context","createContext","ctrlmap","Consumer","CV2612Provider","_React$Component","call","handleCC","activeParameter","learning","Object","assign","setState","reactLocalStorage","setObject","_Object$entries","entries","_Object$entries$_i","floor","updateParam","toggleLearning","toggleSound","soundOn","emulator","sendParameter","code","parts","split","midi","sendSysexSet","setActiveParameter","updateParams","_i2","_Object$entries2","_Object$entries2$_i","filterChannel","filters","envelopes","componentDidMount","getObject","componentWillUnmount","componentDidUpdate","prevProps","prevState","_this2","p1","p2","env_params","diff","keys","reduce","_Object$assign","envs","acc","substring","filter","forEach","calculateEnvelopePoints","x1","round","y1","x2","d1","y2","x3","d2","map","Provider","Midi","midiInId","midiOutId","midiAccess","onChangeMidiIn","ev","setMidiIn","target","onChangeMidiOut","setMidiOut","sendSysex","data","sendMidi","msg","chksum","ma","midiOut","get","send","onMIDIStateChange","port","manufacturer","type","refreshMidiPorts","onMIDIMessage","from","context","lastMsg","JSON","stringify","onLearnClick","preventDefault","onPanicClick","onClearClick","onToggleSoundClick","midiIns","midiOuts","navigator","requestMIDIAccess","sysex","then","onstatechange","set","sendHandshake","midiIn","inputs","onmidimessage","values","includes","className","onChange","href","onClick","fa","contextType","seqTimeOut","seqNote","seqNoteOn","Sequencer","sequencerOn","sequencerStop","clearTimeout","sequencerTick","sort","random","duration","setTimeout","Patches","addDmpPatch","patch","patches","onChangeHandler","_loop","_isArray","_iterator","_ref","next","done","fr","FileReader","onload","Int8Array","result","readAsArrayBuffer","files","isArray","Symbol","iterator","current","onSave","onCreate","prompt","onDelete","onLoadDefaults","loadDefaultPatches","onLeftClick","onRightClick","onUploadClick","refs","file","click","XMLHttpRequest","onreadystatechange","readyState","_loop2","_isArray2","_iterator2","_ref2","responseType","response","open","encodeURI","responseText","style","display","ref","accept","multiple","Envelope","height","width","viewBox","xmlns","points","defaultProps","Slider","componentWillMount","mapped","min","Operator","slider","envelope","Channel","algorithm","algorithmAscii","operator","Channels","onFilterChannel","attributes","Fragment","channel","Device","sequencer","cv2612_patches","channels","CV2612Index","cv2612","location","seo","device","__webpack_require__","__webpack_exports__","StaticQuery","react__WEBPACK_IMPORTED_MODULE_0__","react__WEBPACK_IMPORTED_MODULE_0___default","prop_types__WEBPACK_IMPORTED_MODULE_1__","prop_types__WEBPACK_IMPORTED_MODULE_1___default","gatsby_link__WEBPACK_IMPORTED_MODULE_2__","gatsby_link__WEBPACK_IMPORTED_MODULE_2___default","StaticQueryContext","staticQueryData","query","propTypes","PropTypes","object","string","isRequired","func","module","exports","require","default","SEO","description","lang","meta","keywords","react__WEBPACK_IMPORTED_MODULE_1___default","gatsby__WEBPACK_IMPORTED_MODULE_4__","detailsQuery","metaDescription","site","siteMetadata","react_helmet__WEBPACK_IMPORTED_MODULE_3___default","htmlAttributes","titleTemplate","content","property","author","concat","_public_static_d_1025518380_json__WEBPACK_IMPORTED_MODULE_0__","array","arrayOf","ProdPageRenderer","pageResources","loader","getResourcesForPathnameSync","pathname","InternalPageRenderer","json","shape","swaps","Brand","getDiff","to","intervalId","setInterval","bind","clearInterval","react__WEBPACK_IMPORTED_MODULE_2___default","gatsby__WEBPACK_IMPORTED_MODULE_3__"],"mappings":"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C,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,GACpC,CAAC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,GAGpC,CAAC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,GACpC,CAAC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,GACpC,CAAC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,GACpC,CAAC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,GACpC,CAAC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,GACpC,CAAC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,GACpC,CAAC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,GACpC,CAAC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,GAGpC,CAAC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,GACpC,CAAC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,GACpC,CAAC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,GACpC,CAAC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,GACpC,CAAC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,GACpC,CAAC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,GACpC,CAAC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,GACpC,CAAC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,GAGpC,CAAC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,GACpC,CAAC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,GACpC,CAAC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,GACpC,CAAC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,GACpC,CAAC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,GACpC,CAAC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,GACpC,CAAC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,GACpC,CAAC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAG,GAAK,IAGlC,CAAC,EA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","file":"component---src-pages-cv-2612-js-ef89362da1d99fd7e52b.js","sourcesContent":["import React from \"react\"\nimport Brand from \"../components/header/brand\"\nimport Helmet from \"react-helmet\"\n\nclass Layout extends React.Component {\n\n  render() {\n    const { children } = this.props\n\n    return (\n      <div id=\"app\">\n        <header>\n          <Helmet bodyAttributes={{class:'dark cv2612'}} />\n          <Brand title=\"CV2612\"/>\n        </header>\n        <main>{children}</main>\n      </div>\n    )\n  }\n}\n\nexport default Layout\n","export const dmp2patch = (name,d) =>{\n    //version 9 or 11, genesis, FM patch\n    if( (d[0]===0x09 && d[1]===0x01 && d[2]===0x00)\n        || ( d[0]===0x0B && d[1]===0x02 && d[2]===0x01) ){\n\n        /*\n\n        http://www.deflemask.com/DMP_SPECS.txt\n\n        1 Byte: LFO (FMS on YM2612, PMS on YM2151)\n        1 Byte: FB\n        1 Byte: ALG\n        1 Byte: LFO2 (AMS on YM2612, AMS on YM2151)\n        Repeat this TOTAL_OPERATORS times\n          1 Byte: MULT\n          1 Byte: TL\n          1 Byte: AR\n          1 Byte: DR\n          1 Byte: SL\n          1 Byte: RR\n          1 Byte: AM\n          1 Byte: RS\n          1 Byte: DT (DT2<<4 | DT on YM2151)\n          1 Byte: D2R\n          1 Byte: SSGEG_Enabled <<3 | SSGEG\n          */\n          const params = {}\n          params[`6_4_lfo`] = 0\n          for(let ch=0;ch<=6;ch++){\n            //repeat for 6 channels, and omni channel too\n            params[`${ch}_4_fms`] = d[3]\n            params[`${ch}_4_fb`] = d[4]\n            params[`${ch}_4_al`] = d[5]\n            params[`${ch}_4_ams`] = d[6]\n            params[`${ch}_4_st`] = 3\n            for(let op=0;op<=4;op++){\n              //use first op as omni op\n              const o = (op===4?0:op)*11+7\n              params[`${ch}_${op}_mul`] = d[o+0]\n              params[`${ch}_${op}_tl`] = d[o+1]\n              params[`${ch}_${op}_ar`] = d[o+2]\n              params[`${ch}_${op}_d1`] = d[o+3]\n              params[`${ch}_${op}_sl`] = d[o+4]\n              params[`${ch}_${op}_rr`] = d[o+5]\n              params[`${ch}_${op}_am`] = d[o+6]\n              params[`${ch}_${op}_rs`] = d[o+7]\n              params[`${ch}_${op}_det`] = d[o+8]\n              params[`${ch}_${op}_d2`] = d[o+9]\n            }\n          }\n\n          return {name: name.replace('.dmp',''), params: params}\n    }\n    //else\n    return null\n\n}\n\n\nexport const emptyParams = () =>{\n  const params = {}\n  params[`6_4_lfo`] = 0\n  for(let ch=0;ch<=6;ch++){\n    //repeat for 6 channels, and omni channel too\n    params[`${ch}_4_fms`] = 0\n    params[`${ch}_4_fb`] = 0\n    params[`${ch}_4_al`] = 0\n    params[`${ch}_4_ams`] = 0\n    params[`${ch}_4_st`] = 3\n    for(let op=0;op<=4;op++){\n      params[`${ch}_${op}_mul`] = 0\n      params[`${ch}_${op}_tl`] = 0\n      params[`${ch}_${op}_ar`] = 0\n      params[`${ch}_${op}_d1`] = 0\n      params[`${ch}_${op}_sl`] = 0\n      params[`${ch}_${op}_rr`] = 0\n      params[`${ch}_${op}_am`] = 0\n      params[`${ch}_${op}_rs`] = 0\n      params[`${ch}_${op}_det`] = 0\n      params[`${ch}_${op}_d2`] = 0\n    }\n  }\n  return params\n}\n\n\nconst bitness = (param) =>{\n  const groups = [\n    ['am'],\n    ['rs','st','ams'],\n    ['det','al','fb','fms','lfo'],\n    ['sl','rr','mul'],\n    ['ar','d2','d1'],\n    [],\n    ['tl']\n  ]\n  let bits = 1\n  for(let group of groups){\n    if (group.some((k) => param.endsWith(k)))\n      return bits\n    bits++\n  }\n  console.log('invalid param',param)\n  return 0\n}\n\nexport const emptyMapping = () =>{\n  const mapping = emptyParams()\n  for (let key in mapping) {\n    mapping[key] = {cc:null, ch:null, bits: bitness(key)}\n  }\n  return mapping\n}\n","export default function YM2612() {\n\tif (!this instanceof YM2612) return new YM2612();\n\tthis.version = 0x101;\n\tthis.start = 0;\n\tthis.count = 0;\n\tthis.chip = null;\n}\n\n(function(Y){\n\n/**** CONFIG ****/\nvar cfg = {\n\thq_fm:0,\t// force 53kHz sampling rate\n\tdac_bits:8,\t// DAC width\n\tmaxcalc:0,\t// for logging, # total chan_calc ops to log\n\tdebug:0,\t// for logging\n\tdebugLocal:0,\n\tdebugArr:[],\n\tmode:0,\t// 0=gpgx, 1=vb/scale\n\tstrict:0\t// abort on bad input if true\n};\n\n/**** GLOBALS ****/\nvar _YM = {\t//// used if cfg.mode = 1 (i.e. scale the tables to a ratio of clock) +neo\n\t\"FREQ_SH\":16,\t// 16.16 fixed point (freq calcs)\n\t\"EG_SH\":16,\t// 16.16 fixed point (env gen timing)\n\t\"LFO_SH\":24,\t// 8.24 fixed point (lfo calcs)\n\t\"TIMER_SH\":16\t// 16.16 fixed point (timers calcs)\n};\n_YM.FREQ_MASK = (1<<_YM.FREQ_SH)-1;\n\n/**** ENVELOPE GENERATOR ****/\nvar _ENV = {\n\t\"BITS\":10,\n\t\"MIN_ATT_INDEX\":0\n};\n_ENV.LEN = 1<<_ENV.BITS;\n_ENV.STEP = 128.0/_ENV.LEN;\n_ENV.MAX_ATT_INDEX = _ENV.LEN-1;\n\nvar _EG = {\n\t'ATT':4,\n\t'DEC':3,\n\t'SUS':2,\n\t'REL':1,\n\t'OFF':0\n};\n\n/**** PHASE GENERATOR (detune mask) ****/\nvar _DT = {\n\t\"BITS\":17\n};\n_DT.LEN = 1<<_DT.BITS;\n_DT.MASK = _DT.LEN-1;\n\n/**** OPERATOR UNIT ****/\nvar _SIN = {\n\t\"BITS\":10\n};\n_SIN.LEN = 1<<_SIN.BITS;\n_SIN.MASK = _SIN.LEN-1;\n\nvar _TL = {\n\t\"BITS\":14\n};\n_TL.RES_LEN = 256;\t// sinus resolution\n_TL.TAB_LEN = 13*2*_TL.RES_LEN;\t// 13 = sinus amplitude bits, 2 = sinus sign bit\n_TL.tab = new Array(_TL.TAB_LEN);\n\n_ENV.QUIET = _TL.TAB_LEN>>3;\n\n/* sin waveform table in 'decibel' scale */\n_YM.sin = new Array(_SIN.LEN);\n\n/* sustain level table (3dB per step) */\n/* bit0, bit1, bit2, bit3, bit4, bit5, bit6 */\n/* 1,    2,    4,    8,    16,   32,   64   (value)*/\n/* 0.75, 1.5,  3,    6,    12,   24,   48   (dB)*/\n/* 0 - 15: 0, 3, 6, 9,12,15,18,21,24,27,30,33,36,39,42,93 (dB)*/\n/* attenuation value (10 bits) = (SL << 2) << 3 */\n_YM.sl = (function(){\n\tvar SC = function(db){return (db*4.0/_ENV.STEP)|0;};\n\treturn [\n\t\tSC(0), SC(1), SC(2), SC(3), SC(4), SC(5), SC(6), SC(7),\n\t\tSC(8), SC(9), SC(10), SC(11), SC(12), SC(13), SC(14), SC(31)\n\t];\n})();\n\n_EG.RATE_STEPS = 8;\n_EG.inc = [\t// 19*_EG.RATE_STEPS\n\t/*cycle:0 1  2 3  4 5  6 7*/\n\n\t/* 0 */ 0,1, 0,1, 0,1, 0,1, /* rates 00..11 0 (increment by 0 or 1) */\n\t/* 1 */ 0,1, 0,1, 1,1, 0,1, /* rates 00..11 1 */\n\t/* 2 */ 0,1, 1,1, 0,1, 1,1, /* rates 00..11 2 */\n\t/* 3 */ 0,1, 1,1, 1,1, 1,1, /* rates 00..11 3 */\n\n\t/* 4 */ 1,1, 1,1, 1,1, 1,1, /* rate 12 0 (increment by 1) */\n\t/* 5 */ 1,1, 1,2, 1,1, 1,2, /* rate 12 1 */\n\t/* 6 */ 1,2, 1,2, 1,2, 1,2, /* rate 12 2 */\n\t/* 7 */ 1,2, 2,2, 1,2, 2,2, /* rate 12 3 */\n\n\t/* 8 */ 2,2, 2,2, 2,2, 2,2, /* rate 13 0 (increment by 2) */\n\t/* 9 */ 2,2, 2,4, 2,2, 2,4, /* rate 13 1 */\n\t/*10 */ 2,4, 2,4, 2,4, 2,4, /* rate 13 2 */\n\t/*11 */ 2,4, 4,4, 2,4, 4,4, /* rate 13 3 */\n\n\t/*12 */ 4,4, 4,4, 4,4, 4,4, /* rate 14 0 (increment by 4) */\n\t/*13 */ 4,4, 4,8, 4,4, 4,8, /* rate 14 1 */\n\t/*14 */ 4,8, 4,8, 4,8, 4,8, /* rate 14 2 */\n\t/*15 */ 4,8, 8,8, 4,8, 8,8, /* rate 14 3 */\n\n\t/*16 */ 8,8, 8,8, 8,8, 8,8, /* rates 15 0, 15 1, 15 2, 15 3 (increment by 8) */\n\t/*17 */ 16,16,16,16,16,16,16,16, /* rates 15 2, 15 3 for attack */\n\t/*18 */ 0,0, 0,0, 0,0, 0,0, /* infinity rates for attack and decay(s) */\n];\n\n_EG.rate_select = (function(){\n\tvar O = function(a){return (a*_EG.RATE_STEPS)|0;};\n\treturn [\t// env gen rates - 32+64 rates+32 RKS\n\t\t/* 32 infinite time rates (same as Rate 0) */\n\t\tO(18),O(18),O(18),O(18),O(18),O(18),O(18),O(18),\n\t\tO(18),O(18),O(18),O(18),O(18),O(18),O(18),O(18),\n\t\tO(18),O(18),O(18),O(18),O(18),O(18),O(18),O(18),\n\t\tO(18),O(18),O(18),O(18),O(18),O(18),O(18),O(18),\n\n\t\t/* rates 00-11 */\n\t\t/*\n\t\tO( 0),O( 1),O( 2),O( 3),\n\t\tO( 0),O( 1),O( 2),O( 3),\n\t\t*/\n\t\tO(18),O(18),O( 0),O( 0),\n\t\tO( 0),O( 0),O( 2),O( 2),   // Nemesis's tests\n\n\t\tO( 0),O( 1),O( 2),O( 3),\n\t\tO( 0),O( 1),O( 2),O( 3),\n\t\tO( 0),O( 1),O( 2),O( 3),\n\t\tO( 0),O( 1),O( 2),O( 3),\n\t\tO( 0),O( 1),O( 2),O( 3),\n\t\tO( 0),O( 1),O( 2),O( 3),\n\t\tO( 0),O( 1),O( 2),O( 3),\n\t\tO( 0),O( 1),O( 2),O( 3),\n\t\tO( 0),O( 1),O( 2),O( 3),\n\t\tO( 0),O( 1),O( 2),O( 3),\n\n\t\t/* rate 12 */\n\t\tO( 4),O( 5),O( 6),O( 7),\n\n\t\t/* rate 13 */\n\t\tO( 8),O( 9),O(10),O(11),\n\n\t\t/* rate 14 */\n\t\tO(12),O(13),O(14),O(15),\n\n\t\t/* rate 15 */\n\t\tO(16),O(16),O(16),O(16),\n\n\t\t/* 32 dummy rates (same as 15 3) */\n\t\tO(16),O(16),O(16),O(16),O(16),O(16),O(16),O(16),\n\t\tO(16),O(16),O(16),O(16),O(16),O(16),O(16),O(16),\n\t\tO(16),O(16),O(16),O(16),O(16),O(16),O(16),O(16),\n\t\tO(16),O(16),O(16),O(16),O(16),O(16),O(16),O(16)\n\t];\n})();\n\n/*rate  0,    1,    2,   3,   4,   5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15*/\n/*shift 11,   10,   9,   8,   7,   6,  5,  4,  3,  2, 1,  0,  0,  0,  0,  0 */\n/*mask  2047, 1023, 511, 255, 127, 63, 31, 15, 7,  3, 1,  0,  0,  0,  0,  0 */\n_EG.rate_shift = (function(){\n\tvar O = function(a){return (a)|0;};\n\treturn [\t// env gen counter shifts - 32+64 rates+32 RKS\n\t\t/* 32 infinite time rates */\n\t\t/* O(0),O(0),O(0),O(0),O(0),O(0),O(0),O(0),\n\t\tO(0),O(0),O(0),O(0),O(0),O(0),O(0),O(0),\n\t\tO(0),O(0),O(0),O(0),O(0),O(0),O(0),O(0),\n\t\tO(0),O(0),O(0),O(0),O(0),O(0),O(0),O(0), */\n\n\t\t/* fixed (should be the same as rate 0, even if it makes no difference since increment value is 0 for these rates) */\n\t\tO(11),O(11),O(11),O(11),O(11),O(11),O(11),O(11),\n\t\tO(11),O(11),O(11),O(11),O(11),O(11),O(11),O(11),\n\t\tO(11),O(11),O(11),O(11),O(11),O(11),O(11),O(11),\n\t\tO(11),O(11),O(11),O(11),O(11),O(11),O(11),O(11),\n\n\t\t/* rates 00-11 */\n\t\tO(11),O(11),O(11),O(11),\n\t\tO(10),O(10),O(10),O(10),\n\t\tO( 9),O( 9),O( 9),O( 9),\n\t\tO( 8),O( 8),O( 8),O( 8),\n\t\tO( 7),O( 7),O( 7),O( 7),\n\t\tO( 6),O( 6),O( 6),O( 6),\n\t\tO( 5),O( 5),O( 5),O( 5),\n\t\tO( 4),O( 4),O( 4),O( 4),\n\t\tO( 3),O( 3),O( 3),O( 3),\n\t\tO( 2),O( 2),O( 2),O( 2),\n\t\tO( 1),O( 1),O( 1),O( 1),\n\t\tO( 0),O( 0),O( 0),O( 0),\n\n\t\t/* rate 12 */\n\t\tO( 0),O( 0),O( 0),O( 0),\n\n\t\t/* rate 13 */\n\t\tO( 0),O( 0),O( 0),O( 0),\n\n\t\t/* rate 14 */\n\t\tO( 0),O( 0),O( 0),O( 0),\n\n\t\t/* rate 15 */\n\t\tO( 0),O( 0),O( 0),O( 0),\n\n\t\t/* 32 dummy rates (same as 15 3) */\n\t\tO( 0),O( 0),O( 0),O( 0),O( 0),O( 0),O( 0),O( 0),\n\t\tO( 0),O( 0),O( 0),O( 0),O( 0),O( 0),O( 0),O( 0),\n\t\tO( 0),O( 0),O( 0),O( 0),O( 0),O( 0),O( 0),O( 0),\n\t\tO( 0),O( 0),O( 0),O( 0),O( 0),O( 0),O( 0),O( 0)\n\t];\n})();\n\n_DT.tab = [\t// 4*32\n\t/* this is YM2151 and YM2612 phase increment data (in 10.10 fixed point format)*/\n\t/* FD=0 */\n\t0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n\t0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n\t/* FD=1 */\n\t0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2,\n\t2, 3, 3, 3, 4, 4, 4, 5, 5, 6, 6, 7, 8, 8, 8, 8,\n\t/* FD=2 */\n\t1, 1, 1, 1, 2, 2, 2, 2, 2, 3, 3, 3, 4, 4, 4, 5,\n\t5, 6, 6, 7, 8, 8, 9,10,11,12,13,14,16,16,16,16,\n\t/* FD=3 */\n\t2, 2, 2, 2, 2, 3, 3, 3, 4, 4, 4, 5, 5, 6, 6, 7,\n\t8 , 8, 9,10,11,12,13,14,16,17,19,20,22,22,22,22\n];\n\n\n/* OPN key frequency number -> key code follow table */\n/* fnum higher 4bit -> keycode lower 2bit */\nvar OPN = {\n\t\"fktable\":[0,0,0,0,0,0,0,1,2,3,3,3,3,3,3,3],\n};\n\nvar LFO = {\n\t/* 8 LFO speed parameters */\n\t/* each value represents number of samples that one LFO level will last for */\n\t\"samples_per_step\":[108, 77, 71, 67, 62, 44, 8, 5],\n\t/*There are 4 different LFO AM depths available, they are:\n\t  0 dB, 1.4 dB, 5.9 dB, 11.8 dB\n\t  Here is how it is generated (in EG steps):\n\n\t  11.8 dB = 0, 2, 4, 6, 8, 10,12,14,16...126,126,124,122,120,118,....4,2,0\n\t   5.9 dB = 0, 1, 2, 3, 4, 5, 6, 7, 8....63, 63, 62, 61, 60, 59,.....2,1,0\n\t   1.4 dB = 0, 0, 0, 0, 1, 1, 1, 1, 2,...15, 15, 15, 15, 14, 14,.....0,0,0\n\n\t  (1.4 dB is loosing precision as you can see)\n\n\t  It's implemented as generator from 0..126 with step 2 then a shift\n\t  right N times, where N is:\n\t    8 for 0 dB\n\t    3 for 1.4 dB\n\t    1 for 5.9 dB\n\t    0 for 11.8 dB\n\t*/\n\t\"ams_depth_shift\":[8,3,1,0],\n\t/*There are 8 different LFO PM depths available, they are:\n\t  0, 3.4, 6.7, 10, 14, 20, 40, 80 (cents)\n\n\t  Modulation level at each depth depends on F-NUMBER bits: 4,5,6,7,8,9,10\n\t  (bits 8,9,10 = FNUM MSB from OCT/FNUM register)\n\n\t  Here we store only first quarter (positive one) of full waveform.\n\t  Full table (lfo_pm_table) containing all 128 waveforms is build\n\t  at run (init) time.\n\n\t  One value in table below represents 4 (four) basic LFO steps\n\t  (1 PM step = 4 AM steps).\n\n\t  For example:\n\t   at LFO SPEED=0 (which is 108 samples per basic LFO step)\n\t   one value from \"lfo_pm_output\" table lasts for 432 consecutive\n\t   samples (4*108=432) and one full LFO waveform cycle lasts for 13824\n\t   samples (32*432=13824; 32 because we store only a quarter of whole\n\t            waveform in the table below)\n\t*/\n\t\"pm_output\":[\t// [7*8][8]\n\t\t/* 7 bits meaningful (of F-NUMBER), 8 LFO output levels per one depth (out of 32), 8 LFO depths */\n\t\t/* FNUM BIT 4: 000 0001xxxx */\n\t\t/* DEPTH 0 */ [0,   0,   0,   0,   0,   0,   0,   0],\n\t\t/* DEPTH 1 */ [0,   0,   0,   0,   0,   0,   0,   0],\n\t\t/* DEPTH 2 */ [0,   0,   0,   0,   0,   0,   0,   0],\n\t\t/* DEPTH 3 */ [0,   0,   0,   0,   0,   0,   0,   0],\n\t\t/* DEPTH 4 */ [0,   0,   0,   0,   0,   0,   0,   0],\n\t\t/* DEPTH 5 */ [0,   0,   0,   0,   0,   0,   0,   0],\n\t\t/* DEPTH 6 */ [0,   0,   0,   0,   0,   0,   0,   0],\n\t\t/* DEPTH 7 */ [0,   0,   0,   0,   1,   1,   1,   1],\n\n\t\t/* FNUM BIT 5: 000 0010xxxx */\n\t\t/* DEPTH 0 */ [0,   0,   0,   0,   0,   0,   0,   0],\n\t\t/* DEPTH 1 */ [0,   0,   0,   0,   0,   0,   0,   0],\n\t\t/* DEPTH 2 */ [0,   0,   0,   0,   0,   0,   0,   0],\n\t\t/* DEPTH 3 */ [0,   0,   0,   0,   0,   0,   0,   0],\n\t\t/* DEPTH 4 */ [0,   0,   0,   0,   0,   0,   0,   0],\n\t\t/* DEPTH 5 */ [0,   0,   0,   0,   0,   0,   0,   0],\n\t\t/* DEPTH 6 */ [0,   0,   0,   0,   1,   1,   1,   1],\n\t\t/* DEPTH 7 */ [0,   0,   1,   1,   2,   2,   2,   3],\n\n\t\t/* FNUM BIT 6: 000 0100xxxx */\n\t\t/* DEPTH 0 */ [0,   0,   0,   0,   0,   0,   0,   0],\n\t\t/* DEPTH 1 */ [0,   0,   0,   0,   0,   0,   0,   0],\n\t\t/* DEPTH 2 */ [0,   0,   0,   0,   0,   0,   0,   0],\n\t\t/* DEPTH 3 */ [0,   0,   0,   0,   0,   0,   0,   0],\n\t\t/* DEPTH 4 */ [0,   0,   0,   0,   0,   0,   0,   1],\n\t\t/* DEPTH 5 */ [0,   0,   0,   0,   1,   1,   1,   1],\n\t\t/* DEPTH 6 */ [0,   0,   1,   1,   2,   2,   2,   3],\n\t\t/* DEPTH 7 */ [0,   0,   2,   3,   4,   4,   5,   6],\n\n\t\t/* FNUM BIT 7: 000 1000xxxx */\n\t\t/* DEPTH 0 */ [0,   0,   0,   0,   0,   0,   0,   0],\n\t\t/* DEPTH 1 */ [0,   0,   0,   0,   0,   0,   0,   0],\n\t\t/* DEPTH 2 */ [0,   0,   0,   0,   0,   0,   1,   1],\n\t\t/* DEPTH 3 */ [0,   0,   0,   0,   1,   1,   1,   1],\n\t\t/* DEPTH 4 */ [0,   0,   0,   1,   1,   1,   1,   2],\n\t\t/* DEPTH 5 */ [0,   0,   1,   1,   2,   2,   2,   3],\n\t\t/* DEPTH 6 */ [0,   0,   2,   3,   4,   4,   5,   6],\n\t\t/* DEPTH 7 */ [0,   0,   4,   6,   8,   8, 0xa, 0xc],\n\n\t\t/* FNUM BIT 8: 001 0000xxxx */\n\t\t/* DEPTH 0 */ [0,   0,   0,   0,   0,   0,   0,   0],\n\t\t/* DEPTH 1 */ [0,   0,   0,   0,   1,   1,   1,   1],\n\t\t/* DEPTH 2 */ [0,   0,   0,   1,   1,   1,   2,   2],\n\t\t/* DEPTH 3 */ [0,   0,   1,   1,   2,   2,   3,   3],\n\t\t/* DEPTH 4 */ [0,   0,   1,   2,   2,   2,   3,   4],\n\t\t/* DEPTH 5 */ [0,   0,   2,   3,   4,   4,   5,   6],\n\t\t/* DEPTH 6 */ [0,   0,   4,   6,   8,   8, 0xa, 0xc],\n\t\t/* DEPTH 7 */ [0,   0,   8, 0xc,0x10,0x10,0x14,0x18],\n\n\t\t/* FNUM BIT 9: 010 0000xxxx */\n\t\t/* DEPTH 0 */ [0,   0,   0,   0,   0,   0,   0,   0],\n\t\t/* DEPTH 1 */ [0,   0,   0,   0,   2,   2,   2,   2],\n\t\t/* DEPTH 2 */ [0,   0,   0,   2,   2,   2,   4,   4],\n\t\t/* DEPTH 3 */ [0,   0,   2,   2,   4,   4,   6,   6],\n\t\t/* DEPTH 4 */ [0,   0,   2,   4,   4,   4,   6,   8],\n\t\t/* DEPTH 5 */ [0,   0,   4,   6,   8,   8, 0xa, 0xc],\n\t\t/* DEPTH 6 */ [0,   0,   8, 0xc,0x10,0x10,0x14,0x18],\n\t\t/* DEPTH 7 */ [0,   0,0x10,0x18,0x20,0x20,0x28,0x30],\n\n\t\t/* FNUM BIT10: 100 0000xxxx */\n\t\t/* DEPTH 0 */ [0,   0,   0,   0,   0,   0,   0,   0],\n\t\t/* DEPTH 1 */ [0,   0,   0,   0,   4,   4,   4,   4],\n\t\t/* DEPTH 2 */ [0,   0,   0,   4,   4,   4,   8,   8],\n\t\t/* DEPTH 3 */ [0,   0,   4,   4,   8,   8, 0xc, 0xc],\n\t\t/* DEPTH 4 */ [0,   0,   4,   8,   8,   8, 0xc,0x10],\n\t\t/* DEPTH 5 */ [0,   0,   8, 0xc,0x10,0x10,0x14,0x18],\n\t\t/* DEPTH 6 */ [0,   0,0x10,0x18,0x20,0x20,0x28,0x30],\n\t\t/* DEPTH 7 */ [0,   0,0x20,0x30,0x40,0x40,0x50,0x60]\n\t],\n\t/* all 128 LFO PM waveforms */\n\t/* 128 combinations of 7 bits meaningful (of F-NUMBER), 8 LFO depths, 32 LFO output levels per one depth */\n\t\"pm_table\":new Array(128*8*32)\n};\n\nOPN.CHAN = function(N){return N&0x3;};\nOPN.SLOT = function(N){return (N>>2)&0x3;};\n\n/* slot number */\nvar _SLOT = [0,2,1,3];\n\n/**** END GLOBALS ****/\n\n/**** FM STRUCTS based on genplus-gx ****/\nfunction FM_SLOT() {\n\tthis.DT = -1;\t// index into ym2612.OPN.ST.dt_tab, formerly INT32*\tdetune: dt_tab[DT]\n\tthis.KSR = 0;\t// UINT8\tkey scale rate: 3-KSR\n\tfunction _rate() {\n\t\tthis.ar = 0;\t// UINT32\tattack rate\n\t\tthis.d1r = 0;\t// UINT32\tdecay rate\n\t\tthis.d2r = 0;\t// UINT32\tsustain rate\n\t\tthis.rr = 0;\t// UINT32\trelease rate\n\t\tthis.ksr = 0;\t// UINT8\tkey scale rate: kcode>>(3-KSR)\n\t\tthis.mul = 1;\t// UINT32\tmultiple: ML_TABLE[ML]\n\t\tthis.init = function() {\n\t\t\tthis.ar = 0;\n\t\t\tthis.d1r = 0;\n\t\t\tthis.d2r = 0;\n\t\t\tthis.rr = 0;\n\t\t\tthis.ksr = 0;\n\t\t\tthis.mul = 1;\n\t\t};\n\t\tthis.toString = function(){return [\"MUL=\"+this.mul,\"KS=\"+this.ksr,\"AR=\"+this.ar,\"D1R=\"+this.d1r,\"D2R=\"+this.d2r,\"RR=\"+this.rr].join(',');};\n\t}\n\tthis.rate = new _rate();\n\t// phase generator\n\tthis.phase = 0;\t// UINT32\tphase counter\n\tthis.Incr = 0;\t// INT32\tphase step\n\t// envelope generator\n\tthis.state = 0;\t// UINT8\tphase type\n\tthis.tl = 0;\t// UINT32\ttotal level: TL<<3\n\tthis.volume = 0;\t// UINT32\tenvelope counter\n\tthis.sl = 0;\t// UINT32\tsustain level: sl_table[SL]\n\tthis.vol_out = 0;\t// UINT32\tcurrent output from EG (without AM from LFO)\n\tfunction _eg() {\n\t\tthis.ar=0;\t// UINT8\n\t\tthis.d1r=0;\t// UINT8\n\t\tthis.d2r=0;\t// UINT8\n\t\tthis.rr=0;\t// UINT8\n\t\tthis.init = function(){\n\t\t\tthis.ar=0;\t// UINT8\n\t\t\tthis.d1r=0;\t// UINT8\n\t\t\tthis.d2r=0;\t// UINT8\n\t\t\tthis.rr=0;\t// UINT8\n\t\t};\n\t}\n\tthis.eg = {\n\t\tsh:new _eg(),\t// state\n\t\tsel:new _eg(),\n\t\tinit:function(){this.sh.init();this.sel.init();}\n\t};\n\tthis.ssg = 0;\t// UINT8\tssg-eg waveform\n\tthis.ssgn = 0;\t// UINT8\tssg-eg negated output\n\tthis.key = 0;\t// UINT8\t0 = last key was KEY_OFF, 1 = KEY_ON\n\t// lfo\n\tthis.AMmask = 0;\t// UINT32\tAM enable flag\n\tthis.reset = function() {\n\t\tthis.Incr = -1;\n\t\tthis.key = 0;\n\t\tthis.phase = 0;\n\t\tthis.ssgn = 0;\n\t\tthis.state = _EG.OFF;\n\t\tthis.volume = _ENV.MAX_ATT_INDEX;\n\t\tthis.vol_out = _ENV.MAX_ATT_INDEX;\n\t\tthis.out[0] = 0;\n    this.out[1] = 0;\n\t};\n\tthis.debug = {\n\t\t\"dt1mul\":0, \"dt1\":0, \"mul\":0,\n\t\t\"tl\":0,\n\t\t\"ksar\":0, \"ks\":0, \"ar\":0,\n\t\t\"amd1r\":0, \"am\":0, \"d1r\":0,\n\t\t\"d2r\":0,\n\t\t\"slrr\":0, \"sl\":0, \"rr\":0\n\t};\n\tthis.debug.toString = function(){return [\n\t\t\"TL:\"+(this.tl),\n\t\t\"DT1:\"+this.dt1,\n\t\t\"MUL:\"+this.mul,\n\t\t\"KS:\"+this.ks,\"AR:\"+this.ar,\n\t\t\"AM:\"+this.am,\"D1R:\"+this.d1r,\n\t\t\"D2R:\"+this.d2r,\n\t\t\"SL:\"+(this.sl),\"RR:\"+this.rr\n\t].join(',');};\n\tthis.out = [0,0];\t// replace FM_CH.op1_out +neo\n\tthis.toString = function(){return \"OP{\"+this.debug.toString()+\"}\";};\n}\nfunction FM_CH() {\n\tthis.SLOT = [\t// four slots/ops\n\t\tnew FM_SLOT(),\n\t\tnew FM_SLOT(),\n\t\tnew FM_SLOT(),\n\t\tnew FM_SLOT()\n\t];\n\tthis.ALGO = 0;\t// UINT8\talgorithm\n\tthis.FB = 0;\t// UINT8\tfeedback shift\n\tthis.op1_out = [0,0];\t// INT32\top1 output for feedback (stereo)\n\tthis.connect = ['x','x','x','x'];\t// SLOT output pointers, formerly INT32*[4]\n\tthis.mem = {\n\t\tconnect:'mem',\t// INT32*\twhere to put the delayed sample (MEM)\n\t\tvalue:0\t// INT32\tdelated sample (MEM) value\n\t};\n\tthis.pms = 0;\t// INT32\tchannel PMS\n\tthis.ams = 0;\t// UINT8\tchannel AMS\n\tthis.fc = 0;\t// UINT32\tfnum,blk adjusted to sample rate\n\tthis.kcode = 0;\t// UINT8\tkey code\n\tthis.block_fnum = 0;\t// UINT32\tcurrent blk/fnum value for this slot\n\tthis.fn_h = 0;\t// replaces FM_ST.fn_h\n\tthis.outputs = {\n\t\t\"m1\":0,\n\t\t\"m2\":0,\n\t\t\"c1\":0,\n\t\t\"c2\":0,\n\t\t\"mem\":0,\n\t\t\"x\":0,\n\t\t\"out\":0\t// replaces out_fm[ch]\n\t};\n\tthis.canCSM = 0;\t// replaces hardcoded check against CH3\n\tthis.canDAC = 0;\t// replaces hardcoded check against CH6\n\tthis.muted = 0;\n\tthis.pan = [0,0];\t// replaces FM_OPN.pan\n\tthis.reset = function() {\n\t\tthis.mem.value = 0;\n    this.op1_out[0] = 0;\n    this.op1_out[1] = 0;\n\t\tvar s = this.SLOT.length; while (--s>-1) this.SLOT[s].reset();\n\t};\n\tthis.toString = function(){return \"CH{\"+[\n\t\t\"ALGO:\"+this.ALGO,\"FB:\"+this.FB,\n\t\t\"PMS:\"+this.pms,\"AMS:\"+this.ams,\n\t\t\"SLOTS[\"+this.SLOT.join(',')+\"]\"\n\t].join(',')+\"}\";};\n}\nfunction FM_ST(c, r) {\n\tthis.address = 0;\t// UINT16\taddress register\n\tthis.status = 0;\t// UINT8\tstatus flag\n\tthis.mode = 0;\t// UINT32\tCSM/3SLOT mode\n\t//this.fn_h = 0;\t// UINT8\tfreq latch\n\tthis.timer_base = 1;\n\tthis.TA = 0;\t// INT32\ttimer a value\n\tthis.TAL = 0;\t// INT32\ttimer a base\n\tthis.TAC = 0;\t// INT32\ttimer a counter\n\tthis.TB = 0;\t// INT32\ttimer b value\n\tthis.TBL = 0;\t// INT32\ttimer b base\n\tthis.TBC = 0;\t// INT32\ttimer b counter\n\tthis.dt_tab = [\t// INT32[8][32]\tdetune table\n\t\tnew Array(32),\n\t\tnew Array(32),\n\t\tnew Array(32),\n\t\tnew Array(32),\n\t\tnew Array(32),\n\t\tnew Array(32),\n\t\tnew Array(32),\n\t\tnew Array(32)\n\t];\n\tthis.clock = c||7670448;\n\tthis.rate = r||44100;\n}\n\nfunction FM_3SLOT() {\n\tthis.fc = [0,0,0];\t// UINT32[3]\tfnum3,blk3 calculated\n\tthis.fn_h = 0;\t// UINT8\tfreq3 latch\n\tthis.kcode = [0,0,0];\t// UINT8[3]\tkey code\n\tthis.block_fnum = [0,0,0];\t// UINT32[3]\tcurrent fnum value for this slot\n\tthis.key_csm = 0;\t// UINT8\tCSM mode KEY_ON flag\n}\n\nfunction FM_OPN(c, r) {\n\tthis.ST = new FM_ST(c,r);\n\tthis.SL3 = new FM_3SLOT();\n\t//this.pan = new Array(6*2);\t// UINT[6*2]\tfm channels output masks (0xffffffff = enable)\n\tfunction _timer() {\n\t\tthis.cnt = 0;\n\t\tthis.timer = 0;\n\t\tthis.timer_add = 0;\t// vb\n\t\tthis.timer_overflow = 0;\t// vb unused for eg\n\t\tthis.init = function() {\n\t\t\tthis.cnt = 0;\t// current phase counter (UINT32 for eg, UINT8 for lfo)\n\t\t\tthis.timer = 0;\t// UINT32\n\t\t\tthis.timer_add = 0;\t// UINT32\tstep of timer\n\t\t\tthis.timer_overflow = 0;\t// UINT32\ttimer overflows every N samples\n\t\t};\n\t}\n\tthis.eg = new _timer();\n\tthis.lfo = new _timer();\n\tthis.lfo.AM = 0;\t// UINT32\tcurrent lfo AM step\n\tthis.lfo.PM = 0;\t// UINT32\tcurrent lfo PM step\n\tthis.fn = {\"table\":new Array(4096), \"max\":0};\n}\n\nfunction YMX(c,r) {\n\tthis.CH = [new FM_CH(), new FM_CH(), new FM_CH(), new FM_CH(), new FM_CH(), new FM_CH()];\n\tthis.CH[2].canCSM = 1;\n\tthis.CH[5].canDAC = 1;\n\tthis.dacen = 0;\t// UINT8\n\tthis.dacout = 0;\t// INT32\n\tthis.OPN = new FM_OPN(c,r);\n\tthis.toString = function(){return \"YM[\\n\"+this.CH.join(',\\n')+\"\\n]\";};\n}\n/**** END FM STRUCTS ****/\n\n/**** FM DEFS based on genplus-gx ****/\n/* current chip state */\n//_YM.m2 = 0; _YM.c1 = 0; _YM.c2 = 0;\t// INT32\tphase modulation input for ops 2,3,4\n//_YM.mem = 0;\t// INT32\tone sample delay memory\n//_YM.out_fm = [0,0,0,0,0,0,0,0];\t// INT32[8]\toutputs of working channels\t// REPLACED BY FM_CH.out\n_YM.bitmask = 0;\t//UINT32\tworking channels output bitmasking (DAC quantization)\n\nFM_SLOT.prototype.keyOn = function(x,csm) {\n\tif (!this.key&&!x.OPN.SL3.key_csm) {\n\t\tthis.phase = 0;\t/* restart Phase Generator */\n\t\tthis.ssgn = 0;\t/* reset SSG-EG inversion flag */\n\t\tif ((this.rate.ar+this.rate.ksr)<94)\t/*32+62*/\n\t\t\tthis.state = (this.volume<=_ENV.MIN_ATT_INDEX)?(this.sl===_ENV.MIN_ATT_INDEX?_EG.SUS:_EG.DEC):_EG.ATT;\n\t\telse {\n\t\t\tthis.volume = _ENV.MIN_ATT_INDEX;\t/* force attenuation level to 0 */\n\t\t\tthis.state = (this.sl===_ENV.MIN_ATT_INDEX)?_EG.SUS:_EG.DEC;\n\t\t}\n\t\t/* recalculate EG output */\n\t\tif ((this.ssg&0x08)>0&&(this.ssgn^(this.ssg&0x04))>0) this.vol_out = this.tl+((0x200-this.volume)&_ENV.MAX_ATT_INDEX);\n\t\telse this.vol_out = this.tl+(this.volume|0);\n\t}\n\tif (!csm) this.key = 1;\n};\nFM_CH.prototype.keyOn = function(x,s) {this.SLOT[s].keyOn(x,0);};\n\nFM_SLOT.prototype.keyOff = function(x,csm) {\n\tif ((csm&&!this.key)||(!csm&&this.key&&!x.OPN.SL3.key_csm)) {\n\t\tif (this.state>_EG.REL) {\n\t\t\tthis.state = _EG.REL;\t/* phase -> Release */\n\t\t\t/* SSG-EG specific update */\n\t\t\tif ((this.ssg&0x08)>0) {\n\t\t\t\t/* convert EG attenuation level */\n\t\t\t\tif ((this.ssgn^(this.ssg&0x04))>0) this.volume = (0x200-this.volume)|0;\n\t\t\t\t/* force EG attenuation level */\n\t\t\t\tif (this.volume>=0x200) {\n\t\t\t\t\tthis.volume = _ENV.MAX_ATT_INDEX;\n\t\t\t\t\tthis.state = _EG.OFF;\n\t\t\t\t}\n\t\t\t\tthis.vol_out = this.tl+(this.volume|0);\t/* recalculate EG output */\n\t\t\t}\n\t\t}\n\t}\n\tif (!csm) this.key = 0;\n};\nFM_CH.prototype.keyOff = function(x,s) {this.SLOT[s].keyOff(x,0);};\n\nFM_CH.prototype.keyOnCSM = function(x,s) {this.SLOT[s].keyOn(x,1);};\nFM_CH.prototype.keyOffCSM = function(x,s) {this.SLOT[s].keyOff(x,1);};\n\nFM_CH.prototype.keyControlCSM = function(x) {\n\tthis.keyOnCSM(_SLOT[0]);\n\tthis.keyOnCSM(_SLOT[1]);\n\tthis.keyOnCSM(_SLOT[2]);\n\tthis.keyOnCSM(_SLOT[3]);\n\tx.OPN.SL3.key_csm = 1;\n};\n\nfunction INTERNAL_TIMER_A(x) {\n\tif ((x.OPN.ST.mode&0x01)>0) {\n\t\tif (cfg.mode) x.OPN.ST.TAC -= x.OPN.ST.timer_base;\t// vb\n\t\telse --x.OPN.ST.TAC;\t// gpgx\n\t\tif (x.OPN.ST.TAC<=0) {\n\t\t\t/* set status (if enabled) */\n\t\t\tif ((x.OPN.ST.mode&0x04)>0) x.OPN.ST.status |= 0x01;\n\t\t\t/* reload the counter */\n\t\t\tif (cfg.mode&&x.OPN.ST.TAL) x.OPN.ST.TAC += x.OPN.ST.TAL;\t// vb\n\t\t\telse x.OPN.ST.TAC = x.OPN.ST.TAL;\t// gpgx\n\t\t\t/* CSM mode auto key on */\n\t\t\tif ((x.OPN.ST.mode & 0xC0)===0x80) x.CH[2].keyControlCSM();\n\t\t}\n\t}\n}\nfunction INTERNAL_TIMER_B(x, step) {\n\tif ((x.OPN.ST.mode & 0x02)>0) {\n\t\tif (cfg.mode) x.OPN.ST.TBC -= x.OPN.ST.timer_base*step;\t// vb\n\t\telse x.OPN.ST.TBC -= step;\t// gpgx\n\t\tif (x.OPN.ST.TBC <= 0) {\n\t\t\t/* set status (if enabled) */\n\t\t\tif ((x.OPN.ST.mode & 0x08)>0) x.OPN.ST.status |= 0x02;\n\t\t\t/* reload the counter */\n\t\t\tif (x.OPN.ST.TBL) x.OPN.ST.TBC += x.OPN.ST.TBL;\n\t\t\telse x.OPN.ST.TBC = x.OPN.ST.TBL;\n\t\t}\n\t}\n}\n\n/* OPN Mode Register Write */\nfunction set_timers(x,v) {\n\t/* b7 = CSM MODE */\n\t/* b6 = 3 slot mode */\n\t/* b5 = reset b */\n\t/* b4 = reset a */\n\t/* b3 = timer enable b */\n\t/* b2 = timer enable a */\n\t/* b1 = load b */\n\t/* b0 = load a */\n\tif (((x.OPN.ST.mode^v)&0xc0)>0) {\n\t\tx.CH[2].SLOT[_SLOT[0]].Incr = -1;\t// phase increment need to be recalculated\n\t\t// csm mode disabled and csm keyon active\n\t\tif (((v&0xc0)!==0x80)&&x.OPN.SL3.key_csm) {\n\t\t\t// csm mode keyoff\n\t\t\tx.CH[2].keyOffCSM(_SLOT[0]);\n\t\t\tx.CH[2].keyOffCSM(_SLOT[1]);\n\t\t\tx.CH[2].keyOffCSM(_SLOT[2]);\n\t\t\tx.CH[2].keyOffCSM(_SLOT[3]);\n\t\t\tx.OPN.SL3.key_csm = 0;\n\t\t}\n\t}\n\t// reload timers\n\tif ((v&1)&&!(x.OPN.ST.mode&1)) x.OPN.ST.TAC = x.OPN.ST.TAL;\n\tif ((v&2)&&!(x.OPN.ST.mode&2)) x.OPN.ST.TBC = x.OPN.ST.TBL;\n\t// reset timers flags\n\tx.OPN.ST.status &= ~v>>4;\n\tx.OPN.ST.mode = v;\n}\n\n/* set algorithm connection */\nFM_CH.prototype.setupConnection = function() {\n\tvar carrier = 'out';\n\tvar o = {m1:0, m2:2, c1:1, c2:3};\n\tswitch (this.ALGO) {\n\t\tcase 0:\n\t\t\t/* M1---C1---MEM---M2---C2---OUT */\n\t\t\tthis.connect[o.m1] = 'c1';\n\t\t\tthis.connect[o.c1] = 'mem';\n\t\t\tthis.connect[o.m2] = 'c2';\n\t\t\t//if (mem!=='mem') this.connect[o[mem]] = 'm2';\n\t\t\tthis.mem.connect = 'm2';\n\t\t\tbreak;\n\t\tcase 1:\n\t\t\t/* M1------+-MEM---M2---C2---OUT */\n\t\t\t/*      C1-+                     */\n\t\t\tthis.connect[o.m1] = 'mem';\n\t\t\tthis.connect[o.c1] = 'mem';\n\t\t\tthis.connect[o.m2] = 'c2';\n\t\t\t//if (mem!=='mem') this.connect[o[mem]] = 'm2';\n\t\t\tthis.mem.connect = 'm2';\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\t/* M1-----------------+-C2---OUT */\n\t\t\t/*      C1---MEM---M2-+          */\n\t\t\tthis.connect[o.m1] = 'c2';\n\t\t\tthis.connect[o.c1] = 'mem';\n\t\t\tthis.connect[o.m2] = 'c2';\n\t\t\t//if (mem!=='mem') this.connect[o[mem]] = 'm2';\n\t\t\tthis.mem.connect = 'm2';\n\t\t\tbreak;\n\t\tcase 3:\n\t\t\t/* M1---C1---MEM------+-C2---OUT */\n\t\t\t/*                 M2-+          */\n\t\t\tthis.connect[o.m1] = 'c1';\n\t\t\tthis.connect[o.c1] = 'mem';\n\t\t\tthis.connect[o.m2] = 'c2';\n\t\t\t//if (mem!=='mem') this.connect[o[mem]] = 'c2';\n\t\t\tthis.mem.connect = 'c2';\n\t\t\tbreak;\n\t\tcase 4:\n\t\t\t/* M1---C1-+-OUT */\n\t\t\t/* M2---C2-+     */\n\t\t\t/* MEM: not used */\n\t\t\tthis.connect[o.m1] = 'c1';\n\t\t\tthis.connect[o.c1] = carrier;\n\t\t\tthis.connect[o.m2] = 'c2';\n\t\t\t//if (mem!=='mem') this.connect[o[mem]] = 'mem';\n\t\t\tthis.mem.connect = 'mem';\n\t\t\tbreak;\n\t\tcase 5:\n\t\t\t/*    +----C1----+     */\n\t\t\t/* M1-+-MEM---M2-+-OUT */\n\t\t\t/*    +----C2----+     */\n\t\t\tthis.connect[o.m1] = 'x';\n\t\t\tthis.connect[o.c1] = carrier;\n\t\t\tthis.connect[o.m2] = carrier;\n\t\t\t//if (mem!=='mem') this.connect[o[mem]] = 'm2';\n\t\t\tthis.mem.connect = 'm2';\n\t\t\tbreak;\n\t\tcase 6:\n\t\t\t/* M1---C1-+     */\n\t\t\t/*      M2-+-OUT */\n\t\t\t/*      C2-+     */\n\t\t\t/* MEM: not used */\n\t\t\tthis.connect[o.m1] = 'c1';\n\t\t\tthis.connect[o.c1] = carrier;\n\t\t\tthis.connect[o.m2] = carrier;\n\t\t\t//if (mem!=='mem') this.connect[o[mem]] = 'mem';\n\t\t\tthis.mem.connect = 'mem';\n\t\t\tbreak;\n\t\tcase 7:\n\t\t\t/* M1-+     */\n\t\t\t/* C1-+-OUT */\n\t\t\t/* M2-+     */\n\t\t\t/* C2-+     */\n\t\t\t/* MEM: not used*/\n\t\t\tthis.connect[o.m1] = carrier;\n\t\t\tthis.connect[o.c1] = carrier;\n\t\t\tthis.connect[o.m2] = carrier;\n\t\t\t//if (mem!=='mem') this.connect[o[mem]] = 'mem';\n\t\t\tthis.mem.connect = 'mem';\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tif (cfg.strict) throw new Error(\"CH::setup_connection - unsupported algorithm (\"+this.ALGO+\")\");\n\t\t\telse break;\n\t}\n\tthis.connect[3] = carrier;\n};\n\n/* set detune & multiple */\nFM_SLOT.prototype.set_det_mul = function(x,v) {\n\tthis.rate.mul = ((v&0x0f)>0)?((v&0x0f)<<1):1;\n\tthis.DT = (v>>4)&7;//x.OPN.ST.dt_tab[(v>>4)&7];\n\tthis.debug.dt1mul = v&0xff;\n\tthis.debug.dt1 = this.DT;\n\tthis.debug.mul = v&0x0f;\n};\nFM_CH.prototype.set_det_mul = function(x,s,v) {\n\tthis.SLOT[s].set_det_mul(x,v);\n\tthis.SLOT[_SLOT[0]].Incr = -1;\n};\n\n/* set total level */\nFM_SLOT.prototype.set_tl = function(v) {\n\tthis.debug.tl = (v&0x7f);\n\tthis.tl = (this.debug.tl)<<(_ENV.BITS-7);\t// 7-bit tl\n\t// recalculate eg output\n\tif ((this.ssg&0x08)>0&&((this.ssgn^(this.ssg&0x04))>0)&&this.state>_EG.REL)\n\t\tthis.vol_out = this.tl+(((0x200-this.volume)|0)&_ENV.MAX_ATT_INDEX);\n\telse\n\t\tthis.vol_out = this.tl+((this.volume)|0);\n};\nFM_CH.prototype.set_tl = function(s,v) {this.SLOT[s].set_tl(v);};\n\n/* set attack rate & key scale  */\nFM_SLOT.prototype.set_ar_ksr = function(v) {\n\tthis.debug.ksar = v&0xff;\n\tthis.debug.ks = v>>6;\n\tthis.debug.ar = v&0x1f;\n\tvar old_ksr = this.KSR|0;\n\tthis.rate.ar = ((this.debug.ar)>0)?32+((this.debug.ar)<<1):0;\n\tthis.KSR = 3-(this.debug.ks);\n\t/* Even if it seems unnecessary to do it here, it could happen that KSR and KC  */\n\t/* are modified but the resulted SLOT->ksr value (kc >> SLOT->KSR) remains unchanged. */\n\t/* In such case, Attack Rate would not be recalculated by \"refresh_fc_eg_slot\". */\n\t/* This fixes the intro of \"The Adventures of Batman & Robin\" (Eke-Eke)         */\n\tif ((this.rate.ar+this.rate.ksr)<94) {\t/*32+62*/\n\t\tvar q = (this.rate.ar+this.rate.ksr)|0;\n\t\tthis.eg.sh.ar = _EG.rate_shift[q];\n\t\tthis.eg.sel.ar = _EG.rate_select[q];\n\t}\n\telse {\t/* verified by Nemesis on real hardware (Attack phase is blocked) */\n\t\tthis.eg.sh.ar = 0;\n\t\tthis.eg.sel.ar = 18*_EG.RATE_STEPS;\n\t}\n\treturn this.KSR!==old_ksr;\n};\nFM_CH.prototype.set_ar_ksr = function(s,v) {if (this.SLOT[s].set_ar_ksr(v)) this.SLOT[_SLOT[0]].Incr = -1;};\n\n/* set decay rate */\nFM_SLOT.prototype.set_dr = function(v) {\n\tthis.debug.amd1r = v&0xff;\n\tthis.debug.am = v&0x80;\n\tthis.debug.d1r = v&0x1f;\n\tthis.rate.d1r = ((this.debug.d1r)>0)?32+((this.debug.d1r)<<1):0;\n\tvar q = (this.rate.d1r+this.rate.ksr)|0;\n\tthis.eg.sh.d1r = _EG.rate_shift[q];\n\tthis.eg.sel.d1r = _EG.rate_select[q];\n};\nFM_CH.prototype.set_dr = function(s,v) {this.SLOT[s].set_dr(v);};\n\n/* set sustain rate */\nFM_SLOT.prototype.set_sr = function(v) {\n\tthis.debug.d2r = v&0x1f;\n\tthis.rate.d2r = ((this.debug.d2r)>0)?32+((this.debug.d2r)<<1):0;\n\tvar q = (this.rate.d2r+this.rate.ksr)|0;\n\tthis.eg.sh.d2r = _EG.rate_shift[q];\n\tthis.eg.sel.d2r = _EG.rate_select[q];\n};\nFM_CH.prototype.set_sr = function(s,v) {this.SLOT[s].set_sr(v);};\n\n/* set release rate */\nFM_SLOT.prototype.set_sl_rr = function(v) {\n\tthis.debug.slrr = v&0xff;\n\tthis.debug.sl = (v>>4)&0x0f;\n\tthis.debug.rr = v&0x0f;\n\tthis.sl = _YM.sl[this.debug.sl];\n\t// check eg state changes\n\tif (this.state===_EG.DEC&&this.volume>=(this.sl|0)) this.state = _EG.SUS;\n\tthis.rate.rr = 34+((this.debug.rr)<<2);\n\tvar q = (this.rate.rr+this.rate.ksr)|0;\n\tthis.eg.sh.rr = _EG.rate_shift[q];\n\tthis.eg.sel.rr = _EG.rate_select[q];\n};\nFM_CH.prototype.set_sl_rr = function(s,v) {this.SLOT[s].set_sl_rr(v);};\n\n/* advance LFO to next sample */\nfunction advance_lfo(x) {\n\tvar _upd;\n\tif (cfg.mode) _upd = function(o) {\t// vb\n\t\twhile (o.lfo.timer>=o.lfo.timer_overflow) {\n\t\t\to.lfo.timer -= o.lfo.timer_overflow;\n\t\t\to.lfo.cnt = (o.lfo.cnt+1)&127;\t/* There are 128 LFO steps */\n\t\t\t/* triangle (inverted) */\n\t\t\t/* AM: from 126 to 0 step -2, 0 to 126 step +2 */\n\t\t\tif (o.lfo.cnt<64) o.lfo.AM = (o.lfo.cnt^63)<<1;\n\t\t\telse o.lfo.AM = (o.lfo.cnt&63)<<1;\n\t\t\to.lfo.PM = o.lfo.cnt>>2;\t/* PM works with 4 times slower clock */\n\t\t}\n\t};\n\telse _upd = function(o) {\t// gpgx\n\t\tif (o.lfo.timer>o.lfo.timer_overflow) {\n\t\t\to.lfo.timer = 0;\n\t\t\to.lfo.cnt = (o.lfo.cnt+1)&127;\t/* There are 128 LFO steps */\n\t\t\t/* triangle (inverted) */\n\t\t\t/* AM: from 126 to 0 step -2, 0 to 126 step +2 */\n\t\t\tif (o.lfo.cnt<64) o.lfo.AM = (o.lfo.cnt^63)<<1;\n\t\t\telse o.lfo.AM = (o.lfo.cnt&63)<<1;\n\t\t\to.lfo.PM = o.lfo.cnt>>2;\t/* PM works with 4 times slower clock */\n\t\t}\n\t};\n\tif (x.OPN.lfo.timer_overflow) {\t/* LFO enabled ? */\n\t\t/* increment LFO timer (every samples) */\n\t\tif (cfg.mode) x.OPN.lfo.timer += x.OPN.lfo.timer_add;\t// vb\n\t\telse ++x.OPN.lfo.timer;\t// gpgx\n\t\t/* when LFO is enabled, one level will last for 108, 77, 71, 67, 62, 44, 8 or 5 samples */\n\t\t_upd(x.OPN);\n\t}\n}\n\nFM_SLOT.prototype.advance_eg = function(eg_cnt) {\n\tswitch (this.state) {\n\t\tcase _EG.ATT:\t/* attack phase */\n\t\t\tif (!(eg_cnt&((1<<this.eg.sh.ar)-1))) {\n\t\t\t\tthis.volume += (~this.volume*(_EG.inc[this.eg.sel.ar+((eg_cnt>>this.eg.sh.ar)&7)]))>>4;\t/* update attenuation level */\n\t\t\t\t/* check phase transition*/\n\t\t\t\tif (this.volume<=_ENV.MIN_ATT_INDEX) {\n\t\t\t\t\tthis.volume = _ENV.MIN_ATT_INDEX;\n\t\t\t\t\tthis.state = (this.sl===_ENV.MIN_ATT_INDEX)?_EG.SUS:_EG.DEC;\t/* special case where SL=0 */\n\t\t\t\t}\n\t\t\t\t/* recalculate EG output */\n\t\t\t\tif ((this.ssg&0x08)>0&&(this.ssgn^(this.ssg&0x04))>0) this.vol_out = this.tl+(((0x200-this.volume)|0)&_ENV.MAX_ATT_INDEX);\t/* SSG-EG Output Inversion */\n\t\t\t\telse this.vol_out = this.tl+(this.volume|0);\n\t\t\t}\n\t\t\tbreak;\n\t\tcase _EG.DEC:\t/* decay phase */\n\t\t\tif (!(eg_cnt&((1<<this.eg.sh.d1r)-1))) {\n\t\t\t\tif ((this.ssg&0x08)>0) {\t/* SSG EG type */\n\t\t\t\t\t/* update attenuation level */\n\t\t\t\t\tif (this.volume<0x200) {\n\t\t\t\t\t\tthis.volume += _EG.inc[this.eg.sel.d1r+((eg_cnt>>this.eg.sh.d1r)&7)]<<2;\n\t\t\t\t\t\t/* recalculate EG output */\n\t\t\t\t\t\tif ((this.ssgn^(this.ssg&0x04))>0) this.vol_out = this.tl+(((0x200-this.volume)|0)&_ENV.MAX_ATT_INDEX);\t/* SSG-EG Output Inversion */\n\t\t\t\t\t\telse this.vol_out = this.tl+(this.volume|0);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.volume += (_EG.inc[this.eg.sel.d1r+((eg_cnt>>this.eg.sh.d1r)&7)]);\n\t\t\t\t\tthis.vol_out = this.tl+(this.volume|0);\t/* recalculate EG output */\n\t\t\t\t}\n\t\t\t\t/* check phase transition*/\n\t\t\t\tif (this.volume>=(this.sl|0)) this.state = _EG.SUS;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase _EG.SUS:\t/* sustain phase */\n\t\t\tif (!(eg_cnt&((1<<this.eg.sh.d2r)-1))) {\n\t\t\t\t/* SSG EG type */\n\t\t\t\tif ((this.ssg&0x08)>0) {\n\t\t\t\t\t/* update attenuation level */\n\t\t\t\t\tif (this.volume<0x200) {\n\t\t\t\t\t\tthis.volume += _EG.inc[this.eg.sel.d2r+((eg_cnt>>this.eg.sh.d2r)&7)]<<2;\n\t\t\t\t\t\t/* recalculate EG output */\n\t\t\t\t\t\tif ((this.ssgn^(this.ssg&0x04))>0) this.vol_out = this.tl+(((0x200-this.volume)|0)&_ENV.MAX_ATT_INDEX);\t/* SSG-EG Output Inversion */\n\t\t\t\t\t\telse this.vol_out = this.tl+(this.volume|0);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t/* update attenuation level */\n\t\t\t\t\tthis.volume += (_EG.inc[this.eg.sel.d2r+((eg_cnt>>this.eg.sh.d2r)&7)]);\n\t\t\t\t\t/* check phase transition*/\n\t\t\t\t\tif (this.volume>=_ENV.MAX_ATT_INDEX) this.volume = _ENV.MAX_ATT_INDEX;\t/* do not change SLOT->state (verified on real chip) */\n\t\t\t\t\tthis.vol_out = this.tl+(this.volume|0);\t/* recalculate EG output */\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t\tcase _EG.REL:\t/* release phase */\n\t\t\tif (!(eg_cnt&((1<<this.eg.sh.rr)-1))) {\n\t\t\t\t/* SSG EG type */\n\t\t\t\tif ((this.ssg&0x08)>0) {\n\t\t\t\t\t/* update attenuation level */\n\t\t\t\t\tif (this.volume<0x200) {\n\t\t\t\t\t\tthis.volume += _EG.inc[this.eg.sel.rr+((eg_cnt>>this.eg.sh.rr)&7)]<<2;\n\t\t\t\t\t\t/* check phase transition*/\n\t\t\t\t\t\tif (this.volume>=0x200) {\n\t\t\t\t\t\t\tthis.volume = _ENV.MAX_ATT_INDEX;\n\t\t\t\t\t\t\tthis.state = _EG.OFF;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t/* update attenuation level */\n\t\t\t\t\tthis.volume += (_EG.inc[this.eg.sel.rr+((eg_cnt>>this.eg.sh.rr)&7)]);\n\t\t\t\t\t/* check phase transition*/\n\t\t\t\t\tif (this.volume>=_ENV.MAX_ATT_INDEX) {\n\t\t\t\t\t\tthis.volume = _ENV.MAX_ATT_INDEX;\n\t\t\t\t\t\tthis.state = _EG.OFF;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.vol_out = this.tl+(this.volume|0);\t/* recalculate EG output */\n\t\t\t}\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tif (cfg.strict) throw new Error(\"FM_SLOT::advance_eg - unsupported state (\"+this.state+\")\");\n\t\t\telse break;\n\t}\n};\nFM_CH.prototype.advance_eg = function(eg_cnt) {var j = this.SLOT.length; while (--j>-1) this.SLOT[j].advance_eg(eg_cnt);};\nfunction advance_eg_channels(x, eg_cnt) {var i = x.CH.length; while (--i>-1) x.CH[i].advance_eg(eg_cnt);}\n\n/* SSG-EG update process */\n/* The behavior is based upon Nemesis tests on real hardware */\n/* This is actually executed before each samples */\nFM_SLOT.prototype.update_ssg_eg = function() {\n\t/* detect SSG-EG transition */\n\t/* this is not required during release phase as the attenuation has been forced to MAX and output invert flag is not used */\n\t/* if an Attack Phase is programmed, inversion can occur on each sample */\n\tif ((this.ssg&0x08)>0&&this.volume>=0x200&&this.state>_EG.REL) {\n\t\tif ((this.ssg&0x01)>0) {\t/* bit 0 = hold SSG-EG */\n\t\t\tif ((this.ssg&0x02)>0) this.ssgn = 4;\t/* set inversion flag */\n\t\t\tif (this.state!==_EG.ATT&&!(this.ssgn^(this.ssg&0x04))) this.volume = _ENV.MAX_ATT_INDEX;\t/* force attenuation level during decay phases */\n\t\t}\n\t\telse {\t/* loop SSG-EG */\n\t\t\t/* toggle output inversion flag or reset Phase Generator */\n\t\t\tif ((this.ssg&0x02)>0) this.ssgn ^= 4;\n\t\t\telse this.phase = 0;\n\t\t\t/* same as Key ON */\n\t\t\tif (this.state!==_EG.ATT) {\n\t\t\t\tif ((this.rate.ar+this.rate.ksr)<94)\t/*32+62*/\n\t\t\t\t\tthis.state = (this.volume<=_ENV.MIN_ATT_INDEX)?\n\t\t\t\t\t\t(this.sl===_ENV.MIN_ATT_INDEX?_EG.SUS:_EG.DEC):\n\t\t\t\t\t\t_EG.ATT;\n\t\t\t\telse {\t/* Attack Rate is maximal: directly switch to Decay or Sustain */\n\t\t\t\t\tthis.volume = _ENV.MIN_ATT_INDEX;\n\t\t\t\t\tthis.state = (this.sl===_ENV.MIN_ATT_INDEX)?_EG.SUS:_EG.DEC;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t/* recalculate EG output */\n\t\tif ((this.ssgn^(this.ssg&0x04))>0) this.vol_out = this.tl+(((0x200-this.volume)|0)&_ENV.MAX_ATT_INDEX);\n\t\telse this.vol_out = this.tl+(this.volume|0);\n\t}\n};\nFM_CH.prototype.update_ssg_eg = function() {var j = this.SLOT.length; while (--j>-1) this.SLOT[j].update_ssg_eg();};\n//function update_ssg_eg_channels(x) {var i = x.CH.length; while (--i>-1) x.CH[i].update_ssg_eg();}\n\nFM_SLOT.prototype.update_phase_lfo = function(x, pms, block_fnum) {\n\tvar off = LFO.pm_table[(((block_fnum&0x7f0)>>4)<<8)+pms+x.OPN.lfo.PM];\n\tif (off) {\t/* LFO phase modulation active */\n\t\tif (this.DT<0) {\n\t\t\tconsole.log(\"FM_SLOT::update_phase_lfo - invalid DT\",this.DT);\n\t\t\tif (cfg.strict) throw new Error(\"FM_SLOT::update_phase_lfo - invalid DT=\"+this.DT);\n\t\t\telse return;\n\t\t}\n\t\tvar blk, kc, fc;\n\t\t/* there are 2048 FNUMs that can be generated using FNUM/BLK registers\n\t\t      but LFO works with one more bit of a precision so we really need 4096 elements */\n\t\tblock_fnum = off+(block_fnum<<1);\n\t\tblk = (block_fnum&0x7000)>>12;\n\t\tblock_fnum = block_fnum&0xfff;\n\t\tkc = (blk<<2)|OPN.fktable[block_fnum>>8];\t/* keyscale code */\n\t\t/* (frequency) phase increment counter */\n\t\tif (cfg.mode) {\t// vb\n\t\t\tfc = ((x.OPN.fn.table[block_fnum]>>(7-blk))+x.OPN.ST.dt_tab[this.DT][kc]);\n\t\t\tif (fc<0) fc += x.OPN.fn.max;\t/* (frequency) phase overflow (credits to Nemesis) */\n\t\t}\n\t\telse fc = (((block_fnum<<5)>>(7-blk))+x.OPN.ST.dt_tab[this.DT][kc])&_DT.MASK;\t// gpgx\n\t\tthis.phase +=(fc*this.rate.mul)>>1;\t/* update phase */\n\t}\n\telse this.phase += this.Incr;\t/* LFO phase modulation  = zero */\n};\nFM_SLOT.prototype.update_phase_lfo_precalc = function(x, fc, kc) {\n\tif (fc!==-1) {\n\t\tvar finc;\n\t\tif (cfg.mode) {\t// vb\n\t\t\tfinc = (fc+x.OPN.ST.dt_tab[this.DT][kc]);\n\t\t\tif (finc<0) finc += x.OPN.fn.max;\t/* (frequency) phase overflow (credits to Nemesis) */\n\t\t}\n\t\telse finc = (fc+x.OPN.ST.dt_tab[this.DT][kc])&_DT.MASK;\t// gpgx\n\t\tthis.phase += (finc*this.rate.mul)>>1;\t/* update phase */\n\t}\n\telse this.phase += this.Incr;\n};\nFM_CH.prototype.update_phase_lfo = function(x) {\n\tvar pms = this.pms, block_fnum = this.block_fnum;\n\t//var i = this.SLOT.length; while (--i>-1) this.SLOT[i].update_phase_lfo(x, pms, block_fnum);\n\tvar blk, kc, fc;\n\tvar off = LFO.pm_table[(((block_fnum&0x7f0)>>4)<<8)+pms+x.OPN.lfo.PM];\n\tif (off) {\n\t\tblock_fnum = off+(block_fnum<<1);\n\t\tblk = (block_fnum&0x7000)>>12;\n\t\tblock_fnum = block_fnum&0xfff;\n\t\tkc = (blk<<2)|OPN.fktable[block_fnum>>8];\t/* keyscale code */\n\t\tif (cfg.mode) {\t// vb\n\t\t\tfc = (x.OPN.fn.table[block_fnum]>>(7-blk));\n\t\t}\n\t\telse fc = ((block_fnum<<5)>>(7-blk));\n\t}\n\telse {\n\t\tfc = -1;\n\t}\n\tvar i = this.SLOT.length; while (--i>-1) this.SLOT[_SLOT[i]].update_phase_lfo_precalc(x, fc, kc);\n}\n\n/* update phase increment and envelope generator */\nFM_SLOT.prototype.refresh_fc_eg = function(x, fc, kc) {\n\tif (this.DT<0) {\n\t\tconsole.log(\"FM_SLOT::refresh_fc_eg - invalid DT\",this.DT);\n\t\tif (cfg.strict) throw new Error(\"FM_SLOT::refresh_fc_eg - invalid DT=\"+this.DT);\n\t\telse return;\n\t}\n\tif (cfg.debug>1) console.log(\"OPN.ST.dt_tab[\"+this.DT+\"][\"+kc+\"]\",x.OPN.ST.dt_tab[this.DT][kc]);\n\tfc += x.OPN.ST.dt_tab[this.DT][kc];\t/* add detune value */\n\t/* (frequency) phase overflow (credits to Nemesis) */\n\tif (cfg.mode) {if (fc<0) fc += x.OPN.fn.max;}\t// vb\n\telse fc &= _DT.MASK;\t// gpgx\n\tthis.Incr = (fc*this.rate.mul)>>1;\t/* (frequency) phase increment counter */\n\tkc = kc>>this.KSR;\t/* ksr */\n\tif (this.rate.ksr!==kc) {\n\t\tthis.rate.ksr = kc;\n\t\tvar q = (this.rate.ar+kc)|0;\n\t\tif ((q)<94) {\t/*32+62*/\t/* recalculate envelope generator rates */\n\t\t\tthis.eg.sh.ar = _EG.rate_shift[q];\n\t\t\tthis.eg.sel.ar = _EG.rate_select[q];\n\t\t}\n\t\telse {\t/* verified by Nemesis on real hardware (Attack phase is blocked) */\n\t\t\tthis.eg.sh.ar = 0;\n\t\t\tthis.eg.sel.ar = 18*_EG.RATE_STEPS;\n\t\t}\n\t\tq = (this.rate.d1r+kc)|0;\n\t\tthis.eg.sh.d1r = _EG.rate_shift[q];\n\t\tthis.eg.sel.d1r = _EG.rate_select[q];\n\t\tq = (this.rate.d2r+kc)|0;\n\t\tthis.eg.sh.d2r = _EG.rate_shift[q];\n\t\tthis.eg.sel.d2r = _EG.rate_select[q];\n\t\tq = (this.rate.rr+kc)|0;\n\t\tthis.eg.sh.rr = _EG.rate_shift[q];\n\t\tthis.eg.sel.rr = _EG.rate_select[q];\n\t}\n};\n/* update phase increment counters */\nFM_CH.prototype.refresh_fc_eg = function(x) {\n\tif (this.SLOT[_SLOT[0]].Incr===-1) {\n\t\tvar fc = this.fc|0, kc = this.kcode|0;\n\t\tif (cfg.debug>1) console.log(\"FM_CH::refresh_fc_eg\",fc,kc);\n\t\tvar i = this.SLOT.length; while (--i>-1) this.SLOT[_SLOT[i]].refresh_fc_eg(x, fc, kc);\n\t}\n};\n\nFM_SLOT.prototype.calcVol = function(AM){return (this.vol_out+(AM&this.AMmask))|0;};\n\nvar op_calc;\nif (cfg.mode) op_calc = function(phase, env, pm, fb) {\t// vb\n\tvar p = (env<<3)+_YM.sin[\n\t\t(((phase&~_YM.FREQ_MASK)+(fb?pm:pm<<15))>>_YM.FREQ_SH)&_SIN.MASK\n\t];\n\tif (p>=_TL.TAB_LEN) return 0;\n\treturn _TL.tab[p];\n};\nelse op_calc = function(phase, env, pm, fb) {\t// gpgx\n\tvar p = (env<<3)+_YM.sin[(fb?(phase+pm)>>_SIN.BITS:(phase>>_SIN.BITS)+(pm>>1))&_SIN.MASK];\n\tif (p>=_TL.TAB_LEN) return 0;\n\treturn _TL.tab[p];\n};\n\nFM_SLOT.prototype.calculate = function(inp, am, asFB) {\n\tvar eg_out = (this.vol_out+(am&this.AMmask))|0,//this.calcVol(am),\t// inline FM_SLOT.calcVol(am) for speed\n\t\tval = 0;\n\tif (asFB) {\n\t\tvar o = (this.out[0]+this.out[1])|0;\n\t\tthis.out[0] = this.out[1]|0;\n\t\tval = this.out[0]|0;\n\t\tif (eg_out<_ENV.QUIET) {\n\t\t\tif (!inp) o = 0;\n\t\t\tthis.out[1] = op_calc(this.phase, eg_out, (o<<inp), 1);\n\t\t}\n\t\telse this.out[1] = 0;\n\t}\n\telse if (eg_out<_ENV.QUIET) {\n\t\tthis.out[0] = op_calc(this.phase, eg_out, inp, 0);\n\t\tval = this.out[0]|0;\n\t}\n\telse val = this.out[0] = 0;\n\treturn val;\n};\nFM_CH.prototype.calculate = function(x) {\n\n\tvar AM = x.OPN.lfo.AM>>this.ams;\n\t//if (this.muted) return;\n\tvar val;\n\tvar i, outs = ['x','c1','m2','c2'];\n\tthis.outputs.m2 = 0;\n  this.outputs.c1 = 0;\n  this.outputs.c2 = 0;\n  this.outputs.mem = 0;\n  this.outputs.x = 0;\n\tthis.outputs[this.mem.connect] = this.mem.value;\t/* restore delayed sample (MEM) value to m2 or c2 */\n\t//console.log(\"CH::calculate\",this.connect,this.mem);\n\t/* SLOT 1 */\n\ti = 0; val = this.SLOT[_SLOT[i]].calculate(this.FB, AM, 1);\n\tif (val!==0) {\n\t\tif (this.connect[i]==='x') {\n      this.outputs.x = val;\n      this.outputs.mem = val;\n      this.outputs.c1 = val;\n      this.outputs.c2 = val;\t// algorithm 5\n    }\n\t\telse\n      this.outputs[this.connect[i]] += val;\n\t}\n\t/* SLOT 3 */\n\ti = 2; val = this.SLOT[_SLOT[i]].calculate(this.outputs[outs[i]], AM, 0);\n\tif (val!==0) {\n\t\tif (this.connect[i]==='x') {}\n\t\telse this.outputs[this.connect[i]] += val;\n\t}\n\t/* SLOT 2 */\n\ti = 1; val = this.SLOT[_SLOT[i]].calculate(this.outputs[outs[i]], AM, 0);\n\tif (val!==0) {\n\t\tif (this.connect[i]==='x') {}\n\t\telse this.outputs[this.connect[i]] += val;\n\t}\n\t/* SLOT 4 */\n\ti = 3; val = this.SLOT[_SLOT[i]].calculate(this.outputs[outs[i]], AM, 0);\n\tif (val!==0) {\n\t\tif (this.connect[i]==='x') {}\n\t\telse this.outputs[this.connect[i]] += val;\n\t}\n\tthis.mem.value = this.outputs.mem|0;\t/* store current MEM */\n\tif (this.pms) {\t/* update phase counters AFTER output calculations */\n\t\tif ((x.OPN.ST.mode&0xC0)>0&&this.canCSM) {\t/* add support for 3 slot mode */\n\t\t\tthis.SLOT[_SLOT[0]].update_phase_lfo(x, this.pms, x.OPN.SL3.block_fnum[1]);\n\t\t\tthis.SLOT[_SLOT[1]].update_phase_lfo(x, this.pms, x.OPN.SL3.block_fnum[2]);\n\t\t\tthis.SLOT[_SLOT[2]].update_phase_lfo(x, this.pms, x.OPN.SL3.block_fnum[0]);\n\t\t\tthis.SLOT[_SLOT[3]].update_phase_lfo(x, this.pms, this.block_fnum);\n\t\t}\n\t\telse this.update_phase_lfo(x);\n\t}\n\telse {\t/* no LFO phase modulation */\n\t\tthis.SLOT[_SLOT[0]].phase += this.SLOT[_SLOT[0]].Incr;\n\t\tthis.SLOT[_SLOT[1]].phase += this.SLOT[_SLOT[1]].Incr;\n\t\tthis.SLOT[_SLOT[2]].phase += this.SLOT[_SLOT[2]].Incr;\n\t\tthis.SLOT[_SLOT[3]].phase += this.SLOT[_SLOT[3]].Incr;\n\t}\n};\n\n/* write a OPN mode register 0x20-0x2f */\nOPN.WriteMode = function(x,r,v) {\n\tv = v&0xff;\n  // eslint-disable-next-line\n\tswitch (r) {\n\t\tcase 0x21: break;\t// test mode\n\t\tcase 0x22:\t/* LFO FREQ (YM2608/YM2610/YM2610B/ym2612) */\n\t\t\tif (v&8) {\t/* LFO enabled ? */\n\t\t\t\tif (cfg.mode) x.OPN.lfo.timer_overflow = LFO.samples_per_step[v&7]<<_YM.LFO_SH;\t// vb\n\t\t\t\telse x.OPN.lfo.timer_overflow = LFO.samples_per_step[v&7];\t// gpgx\n\t\t\t}\n\t\t\telse {\t/* hold LFO waveform in reset state */\n\t\t\t\tx.OPN.lfo.timer_overflow = 0;\n\t\t\t\tx.OPN.lfo.timer = 0;\n\t\t\t\tx.OPN.lfo.cnt = 0;\n\t\t\t\tx.OPN.lfo.AM = 126;\n\t\t\t\tx.OPN.lfo.PM = 0;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 0x24:\t/* timer A High 8*/\n\t\t\tx.OPN.ST.TA = (x.OPN.ST.TA&0x03)|(((v)|0)<<2);\n\t\t\tx.OPN.ST.TAL = (1024-x.OPN.ST.TA);\n\t\t\tif (cfg.mode) x.OPN.ST.TAL <<= _YM.TIMER_SH;\t// vb\n\t\t\tbreak;\n\t\tcase 0x25:\t/* timer A Low 2*/\n\t\t\tx.OPN.ST.TA = (x.OPN.ST.TA&0x3fc)|(v&3);\n\t\t\tx.OPN.ST.TAL = (1024-x.OPN.ST.TA);\n\t\t\tif (cfg.mode) x.OPN.ST.TAL <<= _YM.TIMER_SH;\t// vb\n\t\t\tbreak;\n\t\tcase 0x26:\t/* timer B */\n\t\t\tx.OPN.ST.TB = v;\n\t\t\tif (cfg.mode) x.OPN.ST.TBL = (256-v)<<(_YM.TIMER_SH+4);\t// vb\n\t\t\telse x.OPN.ST.TBL = (256-v)<<4;\t// gpgx\n\t\t\tbreak;\n\t\tcase 0x27:\t/* mode, timer control */\n\t\t\tset_timers(x,v);\n\t\t\tbreak;\n\t\tcase 0x28:\t/* key on / off */\n\t\t\tvar c = v&0x03; if (c===3) break;\n\t\t\tif (v&0x04) c += 3;\t/* CH 4-6 */\n\t\t\t(function(ch){\n\t\t\t\tif (v&0x10) ch.keyOn(x,_SLOT[0]); else ch.keyOff(x,_SLOT[0]);\n\t\t\t\tif (v&0x20) ch.keyOn(x,_SLOT[1]); else ch.keyOff(x,_SLOT[1]);\n\t\t\t\tif (v&0x40) ch.keyOn(x,_SLOT[2]); else ch.keyOff(x,_SLOT[2]);\n\t\t\t\tif (v&0x80) ch.keyOn(x,_SLOT[3]); else ch.keyOff(x,_SLOT[3]);\n\t\t\t})(x.CH[c]);\n\t\t\tbreak;\n\n\t}\n};\n\n/* write a OPN register (0x30-0xff) */\nOPN.WriteReg = function(x,r,v) {\n\tv = v&0xff;\n\tvar c = OPN.CHAN(r),\n\t\tsl = OPN.SLOT(r);\n\tif (c>=3) {\t/* 0xX3,0xX7,0xXB,0xXF */\n\t\tif (cfg.strict) throw new Error(\"OPN_Write - unsupported channel \"+c+' or slot '+sl+' from {$'+r.toString(16)+',$'+v.toString(16)+'}');\t// 0x?3, 0x?7, 0x?B, 0x?F\n\t\telse return;\n\t}\n\tif (r>=0x100) c += 3;\n\n// eslint-disable-next-line\n\tswitch (r&0xf0) {\n\t\tcase 0x30:\t/* DET , MUL */\n\t\t\tx.CH[c].set_det_mul(x, sl, v);\n\t\t\tbreak;\n\t\tcase 0x40:\t/* TL */\n\t\t\tx.CH[c].set_tl(sl, v);\n\t\t\tbreak;\n\t\tcase 0x50:\t/* KS, AR */\n\t\t\tx.CH[c].set_ar_ksr(sl, v);\n\t\t\tbreak;\n\t\tcase 0x60:\t/* bit7 = AM ENABLE, DR */\n\t\t\tx.CH[c].set_dr(sl, v);\n\t\t\tx.CH[c].SLOT[sl].AMmask = (v&0x80)?~0:0;\n\t\t\tbreak;\n\t\tcase 0x70:\t/*     SR */\n\t\t\tx.CH[c].set_sr(sl, v);\n\t\t\tbreak;\n\t\tcase 0x80:\t/* SL, RR */\n\t\t\tx.CH[c].set_sl_rr(sl, v);\n\t\t\tbreak;\n\t\tcase 0x90:\t/* SSG-EG */\n\t\t\t(function(S){\n\t\t\t\tS.ssg = v&0x0f;\n\t\t\t\t/* recalculate EG output */\n\t\t\t\tif (S.state>_EG.REL) {\n\t\t\t\t\tif ((S.ssg&0x08)>0&&(S.ssgn^(S.ssg&0x04))>0)\n\t\t\t\t\t\tS.vol_out = S.tl+(((0x200-S.volume)|0)&_ENV.MAX_ATT_INDEX);\n\t\t\t\t\telse\n\t\t\t\t\t\tS.vol_out = S.tl+(S.volume|0);\n\t\t\t\t}\n\t\t\t})(x.CH[c].SLOT[sl]);\n\t\t\tbreak;\n\t\tcase 0xa0:\n\t\t\tvar fn, blk;\n      // eslint-disable-next-line\n\t\t\tswitch (sl) {\n\t\t\t\tcase 0:\t/* 0xa0-0xa2 : FNUM1 */\n\t\t\t\t\t//fn = ((x.OPN.ST.fn_h&7)<<8)+v;\t// old\n\t\t\t\t\t//blk = (x.OPN.ST.fn_h>>3)&0xff;\t// old\n\t\t\t\t\tfn = ((x.CH[c].fn_h&7)<<8)+v;\n\t\t\t\t\tblk = (x.CH[c].fn_h>>3)&0xff;\n\t\t\t\t\tx.CH[c].kcode = (blk<<2)|OPN.fktable[fn>>7];\t/* keyscale code */\n\t\t\t\t\t/* phase increment counter */\n\t\t\t\t\tif (cfg.mode) x.CH[c].fc = x.OPN.fn.table[fn<<1]>>(7-blk);\t// vb\n\t\t\t\t\telse x.CH[c].fc = (fn<<6)>>(7-blk);\t// gpgx\n\t\t\t\t\tx.CH[c].block_fnum = (blk<<11)|fn;\t/* store fnum in clear form for LFO PM calculations */\n\t\t\t\t\tx.CH[c].SLOT[_SLOT[0]].Incr = -1;\n\t\t\t\t\tif (cfg.debug>2) console.log('block_fnum=x',x.CH[c].block_fnum.toString(16),' kcode=',x.CH[c].kcode.toString(16),' fc=',x.CH[c].fc.toString(16));\n\t\t\t\t\tbreak;\n\t\t\t\tcase 1:\t/* 0xa4-0xa6 : FNUM2,BLK */\n\t\t\t\t\t//x.OPN.ST.fn_h = (v&0x3f)|0;\t// old\n\t\t\t\t\tx.CH[c].fn_h = (v&0x3f)|0;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\t/* 0xa8-0xaa : 3CH FNUM1 */\n\t\t\t\t\tif (r<0x100) {\n\t\t\t\t\t\tfn = ((x.OPN.SL3.fn_h&7)<<8)+v;\n\t\t\t\t\t\tblk = x.OPN.SL3.fn_h>>3;\n\t\t\t\t\t\tx.OPN.SL3.kcode[c] = (blk<<2)|OPN.fktable[fn>>7];\t/* keyscale code */\n\t\t\t\t\t\t/* phase increment counter */\n\t\t\t\t\t\tif (cfg.mode) x.OPN.SL3.fc[c] = x.OPN.fn.table[fn<<1]>>(7-blk);\t// vb\n\t\t\t\t\t\telse x.OPN.SL3.fc[c] = (fn<<6)>>(7-blk);\t// gpgx\n\t\t\t\t\t\tx.OPN.SL3.block_fnum[c] = (blk<<11)|fn;\n\t\t\t\t\t\tx.CH[2].SLOT[_SLOT[0]].Incr = -1;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 3:\t/* 0xac-0xae : 3CH FNUM2,BLK */\n\t\t\t\t\tif (r<0x100) x.OPN.SL3.fn_h = v&0x3f;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 0xb0:\n    // eslint-disable-next-line \n\t\t\tswitch (sl) {\n\t\t\t\tcase 0:\t/* 0xb0-0xb2 : FB,ALGO */\n\t\t\t\t\tvar fb = (v>>3)&7;\n\t\t\t\t\tx.CH[c].ALGO = v&7;\n\t\t\t\t\tif (cfg.mode) x.CH[c].FB =  fb?fb+6:0;\t// vb\n\t\t\t\t\telse x.CH[c].FB =  fb;\t// gpgx\n\t\t\t\t\t//console.log(\"C[\",c,']=',x.CH[c].ALGO,','+x.CH[c].FB);\n\t\t\t\t\tx.CH[c].setupConnection();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 1:\t/* 0xb4-0xb6 : L , R , AMS , PMS */\n\t\t\t\t\tx.CH[c].pms = (v&7)<<5;\t /* b0-2 PMS */ /* CH->pms = PM depth * 32 (index in lfo_pm_table) */\n\t\t\t\t\tx.CH[c].ams = LFO.ams_depth_shift[(v>>4)&0x03];\t/* b4-5 AMS */\n\t\t\t\t\t/* PAN :  b7 = L, b6 = R */\n\t\t\t\t\t// TODO: merge pan[] into FM_CH\n\t\t\t\t\tx.CH[c].pan[0] = v&0x80?_YM.bitmask:0;\t// new method\n\t\t\t\t\tx.CH[c].pan[1] = v&0x40?_YM.bitmask:0;\t// new method\n\t\t\t\t\t//x.OPN.pan[(c<<1)+0] = v&0x80?_YM.bitmask:0;\t// old method\n\t\t\t\t\t//x.OPN.pan[(c<<1)+1] = v&0x40?_YM.bitmask:0;\t// old method\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\t}\n};\n\n\nfunction reset_channels(x, num) {if (num>x.CH.length) num = x.CH.length; while (--num>-1) x.CH[num].reset();}\n\n/* prescaler set (and make time tables) */\nOPN.SetPrescaler = function(x, r) {\n\tx.ratio = r||144;\n\tx.OPN.ST.scale = (x.OPN.ST.clock/x.OPN.ST.rate)/x.ratio;\n\tif (cfg.debug) console.log(\"init_timetables\",x.OPN.ST.clock,x.OPN.ST.rate,x.ratio,x.OPN.ST.scale);\n\t// init_timetables\n\tvar d, i, q;\n\tvar z = x.OPN.ST.scale*(1<<(_YM.FREQ_SH-10));\t/* -10 because chip works with 10.10 fixed point, while we use 16.16 */\t// vb\n\t/* build DETUNE table */\n\tfor (d=0; d<4; ++d) {\n\t\tfor (i=0; i<32; ++i) {\n\t\t\tq = _DT.tab[(d<<5)+i];\t// gpgx\n\t\t\tif (cfg.mode) q *= z;\t// vb\n\t\t\tx.OPN.ST.dt_tab[d][i] = q|0;\n\t\t\tx.OPN.ST.dt_tab[d+4][i] = -x.OPN.ST.dt_tab[d][i];\n\t\t}\n\t}\n\t//if (cfg.debug>2) console.log(\"init_timetables dt_tab\",ym.OPN.ST.dt_tab);\n\t/* there are 2048 FNUMs that can be generated using FNUM/BLK registers\n\t  but LFO works with one more bit of a precision so we really need 4096 elements */\n\t/* calculate fnumber -> increment counter table */\n\t/* freq table for octave 7 */\n\t/* OPN phase increment counter = 20bit */\n\t/* the correct formula is : F-Number = (144 * fnote * 2^20 / M) / 2^(B-1) */\n\t/* where sample clock is  M/144 */\n\t/* this means the increment value for one clock sample is FNUM * 2^(B-1) = FNUM * 64 for octave 7 */\n\t/* we also need to handle the ratio between the chip frequency and the emulated frequency (can be 1.0)  */\n\tq = 32.0*z;\n  i = 4096;\n  while (--i>-1) {x.OPN.fn.table[i] = (i*q)|0;}\t// vb\n\tx.OPN.fn.max = (0x20000*z)|0;\t/* maximal frequency is required for Phase overflow calculation, register size is 17 bits (Nemesis) */\t// vb\n\tx.OPN.eg.timer_add = (x.OPN.ST.scale*(1<<_YM.EG_SH))|0;\t// vb\n\tx.OPN.eg.timer_overflow = (3)*(1<<_YM.EG_SH);\t/* EG is updated every 3 samples */\t// vb\n\tx.OPN.lfo.timer_add = (x.OPN.ST.scale*(1<<_YM.LFO_SH))|0;\t/* LFO timer increment (every samples) */\t// vb\n\tx.OPN.ST.timer_base = (x.OPN.ST.scale*(1<<_YM.TIMER_SH))|0;\t/* Timers increment (every samples) */\t// vb\n};\n\n/* initialize generic tables */\nfunction init_tables(ym) {\n\tif (cfg.debug) console.log(\"init_tables\",ym.CH.length);\n\tvar d, i, x;\t// signed int\n\tvar n;\t// signed int\n\tvar o, m;\t// double\n\tvar q, z;\n\tvar PI = Math.PI, LOG = Math.log, POW = Math.pow, SIN = Math.sin;\n\t/* build Linear Power Table */\n\tvar tmp = (_ENV.STEP/32.0), sh = (1<<16), rl2 = _TL.RES_LEN<<1;\n\tfor (x=0; x<_TL.RES_LEN; ++x) {\n\t\tm = sh/POW(2, (x+1)*tmp);\n\t\t//m = m|0;\t// m = Math.floor(m);\t// extraneous, folded into next calculation +neo\n\t\t/* we never reach (1<<16) here due to the (x+1) */\n\t\t/* result fits within 16 bits at maximum */\n\t\t//n = m|0;\t/* 16 bits here */\n\t\t//n >>= 4;\t/* 12 bits here */\n\t\tn = (m|0)>>4;\n\t\tif (n&1) n = (n>>1)+1;\t/* round to nearest */\n\t\telse n = n>>1;\n\t\t/* 11 bits here (rounded) */\n\t\tn <<= 2;\t/* 13 bits here (as in real chip) */\n\t\tz = x<<1;\t/* 14 bits (with sign bit) */\n\t\t_TL.tab[z+0] = n;\n\t\t_TL.tab[z+1] = -n;\n\t\t/* one entry in the 'Power' table use the following format, xxxxxyyyyyyyys with:            */\n\t\t/*        s = sign bit                                                                      */\n\t\t/* yyyyyyyy = 8-bits decimal part (0-TL_RES_LEN)                                            */\n\t\t/* xxxxx    = 5-bits integer 'shift' value (0-31) but, since Power table output is 13 bits, */\n\t\t/*            any value above 13 (included) would be discarded.                             */\n\t\tfor (i=1; i<13; ++i) {\n\t\t\tq = (z+0+i*rl2)|0;\n\t\t\t_TL.tab[q] = _TL.tab[z]>>i;\n\t\t\t_TL.tab[q+1] = -_TL.tab[q];\n\t\t}\n\t}\n\t//console.log(\"TL_TABLE\",_TL.tab.join(\", \"));\n\t/* build Logarithmic Sinus table */\n\tq = PI/_SIN.LEN;\n  z = 8.0/LOG(2.0);\n  tmp = 2.0*4/_ENV.STEP;\n  for (i=0; i<_SIN.LEN; ++i) {\t/* non-standard sinus */\n\t\tm = SIN(((i<<1)+1.0)*q);\t/* checked against the real chip */\n\t\t/* we never reach zero here due to ((i*2)+1) */\n\t\t/* convert to 'decibels' */\n\t\tif (m>0.0) o = LOG(1.0/m)*z;\n\t\telse o = LOG(-1.0/m)*z;\n\t\t//o = o/(_ENV.STEP/4);\t// folded into next calculation +neo\n\t\tn = (o*tmp)|0; //n = (2.0*o)|0;\n\t\tif (n&1) n = (n>>1)+1;\t/* round to nearest */\n\t\telse n = n>>1;\n\t\t_YM.sin[i] = (n<<1)+(m>=0.0?0:1);\t/* 13-bits (8.5) value is formatted for above 'Power' table */\n\t}\n\t//console.log(\"SIN_TAB\",_YM.sin.join(\", \"));\n\t/* build LFO PM modulation table */\n\tfor (i=0; i<8; ++i) {\t/* 8 PM depths */\n\t\tfor (n=0; n<128; ++n) {\t/* 7 bits meaningful of F-NUMBER */\n\t\t\tfor (x=0; x<8; ++x) {\n\t\t\t\tz = 0;\n\t\t\t\tfor (o=0; o<7; ++o) {\t/* 7 bits */\n\t\t\t\t\tif ((n&(1<<o))>0) {\t/* only if bit \"bit_tmp\" is set */\n\t\t\t\t\t\tz += LFO.pm_output[(o<<3)+i][x];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t/* 32 steps for LFO PM (sinus) */\n\t\t\t\td = (n<<8)+(i<<5);\t// fnum*32*8 + i*32\n\t\t\t\tLFO.pm_table[d+x+0] = z;\n\t\t\t\tLFO.pm_table[d+(x^7)+8] = z;\n\t\t\t\tLFO.pm_table[d+x+16] = -z;\n\t\t\t\tLFO.pm_table[d+(x^7)+24] = -z;\n\t\t\t}\n\t\t}\n\t}\n}\n\n/**** END FM DEFS ****/\n\n/**** YM2612 API based on genplus-gx ****/\n\n/* initialize ym2612 emulator */\nY.prototype.init = function(clock,rate) {\n\tif (cfg.debug) console.log(\"OPN::init(\"+clock+','+rate+\")\");\n\tif (!this.chip) this.chip = new YMX(clock, rate);\n\telse {\n    this.chip.ST.clock = clock||7670448;\n    this.chip.ST.rate = rate||44100;}\n\tthis.ratio = 144;\t/* chip is running a VCLK / 144 = MCLK / 7 / 144 */\n\tthis.interval = cfg.mode;\n\tthis.start = 0;\n\tthis.count = 0;\n\tinit_tables(this.chip);\n};\n/* reset OPN registers */\nY.prototype.reset = function() {\n\tif (cfg.debug) console.log(\"OPN::reset\");\n\t(function(x){\n\t\tvar i;\n\t\tOPN.SetPrescaler(x, 144);\t/* YM2612 prescaler is fixed to 1/6, one sample (6 mixed channels) is output for each 24 FM clocks */\n\t\tx.OPN.eg.timer = 0;\n\t\tx.OPN.eg.cnt = 0;\n\t\tx.OPN.lfo.timer_overflow = 0;\n\t\tx.OPN.lfo.timer = 0;\n\t\tx.OPN.lfo.cnt = 0;\n\t\tx.OPN.lfo.AM = 126;\n\t\tx.OPN.lfo.PM = 0;\n\t\tx.OPN.ST.TAC = 0;\n\t\tx.OPN.ST.TBC = 0;\n\t\tx.OPN.SL3.key_csm = 0;\n\t\tx.dacen = 0;\n\t\tx.dacout = 0;\n\t\tset_timers(x, 0x30);\n\t\tx.OPN.ST.TB = 0;\n\t\tx.OPN.ST.TA = 0;\n\t\tif (cfg.mode) {\t// vb\n\t\t\tx.OPN.ST.TBL = 256<<(_YM.TIMER_SH+4);\n\t\t\tx.OPN.ST.TAL = 1024<<(_YM.TIMER_SH);\n\t\t}\n\t\telse {\t// gpgx\n\t\t\tx.OPN.ST.TBL = 256<<4;\n\t\t\tx.OPN.ST.TAL = 1024;\n\t\t}\n\t\treset_channels(x, 6);\n\t\t//for (i=0; i<6; ++i) {if (i!=0) x.CH[i].muted = 1;}\n\t\ti = 0xb6; while (i>=0xb4) {\n\t\t\tif ((i&3)!==3){\n\t\t\t\tOPN.WriteReg(x, i, 0xc0);\n\t\t\t\tOPN.WriteReg(x, i|0x100, 0xc0);\n      }\n\t\t\t--i;\n\t\t}\n\t\ti = 0xb2; while (i>=30) {\n\t\t\tif ((i&3)!==3){\n\t\t\t\tOPN.WriteReg(x, i, 0);\n\t\t\t\tOPN.WriteReg(x, i|0x100, 0);\n      }\n\t\t\t--i;\n\t\t}\n\t})(this.chip);\n\tthis.start = 0;\n\tthis.count = 0;\n};\n/* ym2612 write */\nY.prototype.write = function(a,v) {\n\tif (cfg.debug>1) console.log(\"OPN::write\",a.toString(16),v.toString(16));\n\tv &= 0xff;\t/* adjust to 8 bit bus */\n\tthis.chip.OPN.ST.address = a&0x1ff;\n\t//switch (a) {\n\t//\tcase 0:\t/* address port 0 */\n\t//\t\tthis.chip.OPN.ST.address = v;\n\t//\t\tbreak;\n\t//\tcase 2:\t/* address port 1 */\n\t//\t\tthis.chip.OPN.ST.address = v|0x100;\n\t//\t\tbreak;\n\t//\tdefault:\t/* data port */\n\t\t\tvar addr = this.chip.OPN.ST.address;\t/* verified by Nemesis on real YM2612 */\n\t\t\tswitch (addr&0x1f0) {\n\t\t\t\tcase 0x20:\t/* 0x20-0x2f Mode */\n\t\t\t\t\tswitch (addr) {\n\t\t\t\t\t\tcase 0x2a:\t/* DAC data (ym2612) */\n\t\t\t\t\t\t\tthis.chip.dacout = ((v-0x80)|0)<<6;\t/* convert to 14-bit output */\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 0x2b:\t/* DAC Sel  (ym2612) */\n\t\t\t\t\t\t\tthis.chip.dacen = !!(v&0x80);\t/* b7 = dac enable */\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\t/* OPN section */\n\t\t\t\t\t\t\tOPN.WriteMode(this.chip, addr, v);\t/* write register */\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\t/* 0x30-0xff OPN section */\n\t\t\t\t\tOPN.WriteReg(this.chip, addr, v);\t/* write register */\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\t//break;\n\t//}\n};\nY.prototype.read = function(x){return this.chip.OPN.ST.status&0xff;};\n\n/* Generate samples for ym2612 */\nY.prototype.update = function(len) {\n\t//// update length is given in samples\n\t//// but needs to calculate in chip cycles,\n\t//// adjust afterwards +neo\n\tvar num = len*this.ratio;\t// num cycles\n\tif(cfg.debug) console.log(\"==== YM::update\",\"samples=\"+len,\"cycles=\"+num);\n\tvar buf = [[],[]], j, lt, rt;\n\tvar is_csm = !!(this.chip.OPN.ST.mode&0xc0), dis_csm;\n\tvar i = -1; while (++i<this.chip.CH.length) {\n\t\tif (!is_csm) this.chip.CH[i].refresh_fc_eg(this.chip);\n\t\telse if (this.chip.CH[i].canCSM) {\t/* 3SLOT MODE (operator order is 0,1,3,2) */\n\t\t\tif (this.chip.CH[i].SLOT[_SLOT[0]].Incr===-1) {\n\t\t\t\tthis.chip.CH[i].SLOT[_SLOT[0]].refresh_fc_eg(this.chip, this.chip.OPN.SL3.fc[1], this.chip.OPN.SL3.kcode[1]);\n\t\t\t\tthis.chip.CH[i].SLOT[_SLOT[1]].refresh_fc_eg(this.chip, this.chip.OPN.SL3.fc[2], this.chip.OPN.SL3.kcode[2]);\n\t\t\t\tthis.chip.CH[i].SLOT[_SLOT[2]].refresh_fc_eg(this.chip, this.chip.OPN.SL3.fc[0], this.chip.OPN.SL3.kcode[0]);\n\t\t\t\tthis.chip.CH[i].SLOT[_SLOT[3]].refresh_fc_eg(this.chip, this.chip.CH[i].fc, this.chip.CH[i].kcode);\n\t\t\t}\n\t\t}\n\t}\n\t//var msg = [];\n\t//var z = 1.0*this.chip.OPN.ST.scale, q = (len*z+0.5)|0;//(len*this.chip.OPN.ST.scale+0.5)|0;\t// len;\n\tcfg.debugArr.length = 0;\n\tvar didDac, CL = this.chip.CH.length;\n\t/* buffering */\n\ti = -1; while (++i<len) {\n\t\tlt = 0;\n    rt = 0;\n    dis_csm = !!(this.chip.OPN.SL3.key_csm&2);\n\t\tdidDac = false;\t// one DAC for now\n\t\tj = -1; while (++j<CL) {\n\t\t\t//if (j===0&&i<10) cfg.maxcalc = 10;\n\t\t\t//else cfg.maxcalc = 0;\n\t\t\tthis.chip.CH[j].outputs.out = 0;\t/* clear outputs */\n\t\t\tthis.chip.CH[j].update_ssg_eg();\t/* update SSG-EG output */\n\t\t\tif (this.chip.dacen&&this.chip.CH[j].canDAC&&!didDac){\n\t\t\t\tthis.chip.CH[j].outputs.out += this.chip.dacout;\n        didDac = true;\t/* DAC Mode */\n      }\n\t\t\telse this.chip.CH[j].calculate(this.chip);\t/* calculate FM */\n\t\t\t//if (j===0&&(cfg.debugLocal>0)) cfg.debugArr[cfg.debugArr.length] = this.chip.CH[j].outputs.out, --cfg.debugLocal;\n\t\t\t/* 14-bit accumulator channels outputs (range is -8192;+8192) */\n\t\t\tif (this.chip.CH[j].outputs.out>8192) this.chip.CH[j].outputs.out = 8192;\n\t\t\telse if (this.chip.CH[j].outputs.out<-8192) this.chip.CH[j].outputs.out = -8192;\n\t\t\t/* stereo DAC channels outputs mixing  */\n\t\t\t//if (j===0) msg[i] = (this.chip.CH[j].out&this.chip.OPN.pan[(j<<1)+0]);\n\t\t\t//lt += this.chip.CH[j].out&this.chip.OPN.pan[(j<<1)+0];\t// old method\n\t\t\t//rt += this.chip.CH[j].out&this.chip.OPN.pan[(j<<1)+1];\t// old method\n\t\t\tif (!this.chip.CH[j].muted){\n\t\t\t\tlt += (this.chip.CH[j].outputs.out&this.chip.CH[j].pan[0])|0;\n\t\t\t\trt += (this.chip.CH[j].outputs.out&this.chip.CH[j].pan[1])|0;\n      }\n\t\t\tif (dis_csm&&this.chip.CH[j].canCSM) {\t/* CSM Mode Key ON still disabled */\n\t\t\t\t/* CSM Mode Key OFF (verified by Nemesis on real hardware) */\n\t\t\t\tthis.chip.CH[j].keyOffCSM(this.chip, _SLOT[0]);\n\t\t\t\tthis.chip.CH[j].keyOffCSM(this.chip, _SLOT[1]);\n\t\t\t\tthis.chip.CH[j].keyOffCSM(this.chip, _SLOT[2]);\n\t\t\t\tthis.chip.CH[j].keyOffCSM(this.chip, _SLOT[3]);\n\t\t\t}\n\t\t}\n\t\t/* advance LFO */\n\t\tadvance_lfo(this.chip);\n\t\t/* EG is updated every 3 samples */\n\t\tif (cfg.mode) {\t// vb\n\t\t\tthis.chip.OPN.eg.timer += this.chip.OPN.eg.timer_add;\t/* advance envelope generator */\n\t\t\twhile (this.chip.OPN.eg.timer>=this.chip.OPN.eg.timer_overflow) {\n\t\t\t\tthis.chip.OPN.eg.timer -= this.chip.OPN.eg.timer_overflow;\n\t\t\t\t++this.chip.OPN.eg.cnt;\n\t\t\t\tadvance_eg_channels(this.chip, this.chip.OPN.eg.cnt);\n\t\t\t}\n\t\t}\n\t\telse {\t// gpgx\n\t\t\t++this.chip.OPN.eg.timer;\t/* advance envelope generator */\n\t\t\tif (this.chip.OPN.eg.timer>=3) {\n\t\t\t\tthis.chip.OPN.eg.timer = 0;\n\t\t\t\t++this.chip.OPN.eg.cnt;\n\t\t\t\tadvance_eg_channels(this.chip, this.chip.OPN.eg.cnt);\n\t\t\t}\n\t\t}\n\t\t/* buffering */\n\t\tbuf[0][i] = lt;\n\t\tbuf[1][i] = rt;\n\t\t/* CSM mode: if CSM Key ON has occured, CSM Key OFF need to be sent       */\n\t\t/* only if Timer A does not overflow again (i.e CSM Key ON not set again) */\n\t\tthis.chip.OPN.SL3.key_csm <<= 1;\n\t\tINTERNAL_TIMER_A(this.chip);\t/* timer A control */\n\t\tif (dis_csm) {\t/* CSM Mode Key ON still disabled */\n\t\t\tthis.chip.OPN.SL3.key_csm = 0;\t/* CSM Mode Key OFF (verified by Nemesis on real hardware) */\n\t\t}\n\t}\n\t/* timer B control */\n\tINTERNAL_TIMER_B(this.chip, len);\n\t//if (cfg.debug>1) console.log(\"YM::update\",msg);\n\t//// post-update adjustments +neo\n\t//this.count += num;\n\t//var time = this.start;\t/* FM frame initial timestamp */\n\t//var out = [[],[]];\n\t//i = 0; j = 0;\n\t//do {\n\t//\tout[0][i] = buf[0][j|0];\t/* left channel */\n\t//\tout[1][i] = buf[1][j|0];\t/* right channel */\n\t//\tj += (z), ++i;\n\t\t//time += this.ratio, ++i;\t/* increment time counter */\n\t//} while (i<len);\n\t//this.count = time-num, this.start = time-num;\n\t//this.count = this.start = this.count-num;\n\tif (cfg.debugArr.length>0) console.log(cfg.debugArr.join(\", \"));\n\treturn buf;\n};\n\n/* DAC precision (normally 9-bit on real hardware, implemented through simple 14-bit channel output bitmasking) */\nY.prototype.config = function(bits) {\n\t_YM.bitmask = ~((1<<(_TL.BITS-bits))-1);\n\t/* update L/R panning bitmasks */\n\t/*var i = -1; while (++i<12) {\t// 2out*6ch, ORIGINAL METHOD\n\t\tif (this.chip.OPN.pan[i]) this.chip.OPN.pan[i] = _YM.bitmask;\n\t}*/\n\tvar i = this.chip.CH.length; while (--i>-1) {\t// 6ch*2out, NEW PER-CHANNEL PAN\n\t\tif (this.chip.CH[i].pan[0]) this.chip.CH[i].pan[0] = _YM.bitmask;\n\t\tif (this.chip.CH[i].pan[1]) this.chip.CH[i].pan[1] = _YM.bitmask;\n\t}\n};\n\n/* Toggle channel muting +neo */\nY.prototype.toggle = function(ch,m) {\n\tif (ch<6) this.chip.CH[ch].muted = !m;\n}\n\n/* debug output +neo */\nY.prototype.toString = function(){return this.chip.toString();};\n\nY.prototype.load = function(state){};\nY.prototype.save = function(state){};\n})(YM2612);\n","import {Sound} from 'pizzicato'\nimport YM2612 from './ym2612'\nimport AudioKeys from 'audiokeys'\n\nconst ym = new YM2612()\nconst kb = new AudioKeys({\n      polyphony: 1,\n      rows: 1,\n      priority: 'last'\n    })\n\nconst notes = []\n\nclass Emulator {\n\n  constructor(props){\n    kb.down(this.onKeyDown)\n    kb.up(this.onKeyUp)\n    this.start()\n  }\n\n  //todo: mock audiocontext\n  start(){\n    if(typeof window === 'undefined')\n      return\n    this.fm = new Sound({\n        source: 'script',\n        options: {\n            audioFunction: (e) => {\n                var buffer = ym.update(1024);\n                var output = e.outputBuffer.getChannelData(0);\n                for (var i = 0; i < e.outputBuffer.length; i++)\n                    output[i] = buffer[0][i]/32768;\n            },\n            bufferSize: 1024\n        }\n    })\n  }\n\n  noteOn = (note) => {\n    const f = ( Math.pow(2, ( note-69 ) / 12) ) * 440.0\n    this.onKeyDown({note:note,frequency:f})\n  }\n\n  noteOff = (note) => {\n    this.onKeyUp({note:note})\n  }\n\n  onKeyDown = (note) => {\n    if(notes.indexOf(note.note)===-1)\n      notes.push(note.note)\n\n    let f = note.frequency\n    let block = 2\n    while (f >= 2048) {\n      f /= 2\n      block++\n    }\n    const freq = parseInt(f)\n    ym.write(0xA4, ((freq >> 8) & 0x07) | ( ( block & 0x07 ) << 3))\n    ym.write(0xA0, freq&0xFF)\n\n    if(notes.length===1)\n      ym.write(0x28, 0xF0)\n  }\n\n  onKeyUp = (note) => {\n    for( let i = 0; i < notes.length; i++){\n       if ( notes[i] === note.note)\n         notes.splice(i, 1)\n    }\n\n    if(notes.length===0)\n      ym.write(0x28, 0x00)\n  }\n\n  play(){\n    this.fm.play()\n  }\n  pause(){\n    this.fm.pause()\n  }\n  destroy(){\n    this.fm.stop()\n  }\n\n  update(ch,op,param,value,params){\n    const mask = (key,size,shift) =>{\n      return (params[`${ch}_${op}_${key}`] & (Math.pow(2,size)-1))<<shift\n    }\n\n    if(param==='lfo' ){\n      ym.write(0x22, value & 0x07);\n    }\n    else if(param==='det' || param==='mul' ){\n      const v = mask('det',3,4)|mask('mul',4,0)\n      ym.write(0x30+4*op, v)\n    }\n    else if(param==='tl'){\n      const v = mask('tl',7,0)\n      ym.write(0x40+4*op, v)\n    }\n    else if(param==='rs' || param==='ar' ){\n      const v = mask('rs',2,6)|mask('ar',5,0)\n      ym.write(0x50+4*op, v)\n    }\n    else if(param==='am' || param==='d1' ){\n      const v = mask('am',1,7)|mask('d1',5,0)\n      ym.write(0x60+4*op, v)\n    }\n    else if(param==='d2' ){\n      const v = mask('d2',5,0)\n      ym.write(0x70+4*op, v)\n    }\n    else if(param==='sl' || param==='rr' ){\n      const v = mask('sl',4,4)|mask('rr',4,0)\n      ym.write(0x80+4*op, v)\n    }\n    else if(param==='al' || param==='fb' ){\n      const v = mask('fb',3,3)|mask('al',3,0)\n      ym.write(0xB0, v)\n    }\n    else if(param==='st' || param==='ams'|| param==='fms' ){\n      const v = mask('st',2,6)|mask('ams',2,4)|mask('fms',3,0)\n      ym.write(0xB4, v)\n    }\n\n\n  }\n\n\n}\n\nexport default Emulator\n\n\nym.init(7670448, 44100);\t// call this if the clock and/or output sample rate ever need to change\nym.config(9);\nym.reset();\nym.write(0x28,0x00);\n\n/* YM2612 Test code */\nym.write(0x22, 0x00); // LFO off\nym.write(0x27, 0x00); // Note off (channel 0)\nym.write(0x28, 0x01); // Note off (channel 1)\nym.write(0x28, 0x02); // Note off (channel 2)\nym.write(0x28, 0x04); // Note off (channel 3)\nym.write(0x28, 0x05); // Note off (channel 4)\nym.write(0x28, 0x06); // Note off (channel 5)\nym.write(0x2B, 0x00); // DAC off\nym.write(0x30, 0x71); //\nym.write(0x34, 0x0D); //\nym.write(0x38, 0x33); //\nym.write(0x3C, 0x01); // DT1/MUL\nym.write(0x40, 0x23); //\nym.write(0x44, 0x2D); //\nym.write(0x48, 0x26); //\nym.write(0x4C, 0x00); // Total level\nym.write(0x50, 0x5F); //\nym.write(0x54, 0x99); //\nym.write(0x58, 0x5F); //\nym.write(0x5C, 0x94); // RS/AR\nym.write(0x60, 0x05); //\nym.write(0x64, 0x05); //\nym.write(0x68, 0x05); //\nym.write(0x6C, 0x07); // AM/D1R\nym.write(0x70, 0x02); //\nym.write(0x74, 0x02); //\nym.write(0x78, 0x02); //\nym.write(0x7C, 0x02); // D2R\nym.write(0x80, 0x11); //\nym.write(0x84, 0x11); //\nym.write(0x88, 0x11); //\nym.write(0x8C, 0xA6); // D1L/RR\nym.write(0x90, 0x00); //\nym.write(0x94, 0x00); //\nym.write(0x98, 0x00); //\nym.write(0x9C, 0x00); // Proprietary\nym.write(0xB0, 0x32); // Feedback/algorithm\nym.write(0xB4, 0xC0); // Both speakers on\nym.write(0x28, 0x00); // Key off\nym.write(0xA4, 0x22);\t//\nym.write(0xA0, 0x69); // Set frequency\n\n\n\n\n\n\n/*\n\nfrom http://www.smspower.org/maxim/Documents/YM2612#reg27\n\nPart I memory map\n=================\n\n+------+-----------------+-----+------------------+---------+------------+----------------+--------------+--------+\n| REG  | D7              | D6  | D5               | D4      | D3         | D2             | D1           | D0     |\n+------+-----------------+-----+------------------+---------+------------+----------------+--------------+--------+\n| 22H  |                 |     |                  |         | LFO enable | LFO frequency  |              |        |\n+------+-----------------+-----+------------------+---------+------------+----------------+--------------+--------+\n| 24H  | Timer A MSBs    |     |                  |         |            |                |              |        |\n+------+-----------------+-----+------------------+---------+------------+----------------+--------------+--------+\n| 25H  |                 |     |                  |         |            |                | Timer A LSBs |        |\n+------+-----------------+-----+------------------+---------+------------+----------------+--------------+--------+\n| 26H  | Timer B         |     |                  |         |            |                |              |        |\n+------+-----------------+-----+------------------+---------+------------+----------------+--------------+--------+\n| 27H  | Ch3 mode        |     | Reset B          | Reset A | Enable B   | Enable A       | Load B       | Load A |\n+------+-----------------+-----+------------------+---------+------------+----------------+--------------+--------+\n| 28H  | Operator        |     |                  |         |            | Channel        |              |        |\n+------+-----------------+-----+------------------+---------+------------+----------------+--------------+--------+\n| 29H  |                 |     |                  |         |            |                |              |        |\n+------+-----------------+-----+------------------+---------+------------+----------------+--------------+--------+\n| 2AH  | DAC             |     |                  |         |            |                |              |        |\n+------+-----------------+-----+------------------+---------+------------+----------------+--------------+--------+\n| 2BH  | DAC en          |     |                  |         |            |                |              |        |\n+------+-----------------+-----+------------------+---------+------------+----------------+--------------+--------+\n|      |                 |     |                  |         |            |                |              |        |\n+------+-----------------+-----+------------------+---------+------------+----------------+--------------+--------+\n| 30H+ |                 | DT1 |                  |         | MUL        |                |              |        |\n+------+-----------------+-----+------------------+---------+------------+----------------+--------------+--------+\n| 40H+ |                 | TL  |                  |         |            |                |              |        |\n+------+-----------------+-----+------------------+---------+------------+----------------+--------------+--------+\n| 50H+ | RS              |     |                  | AR      |            |                |              |        |\n+------+-----------------+-----+------------------+---------+------------+----------------+--------------+--------+\n| 60H+ | AM              |     |                  | D1R     |            |                |              |        |\n+------+-----------------+-----+------------------+---------+------------+----------------+--------------+--------+\n| 70H+ |                 |     |                  | D2R     |            |                |              |        |\n+------+-----------------+-----+------------------+---------+------------+----------------+--------------+--------+\n| 80H+ | D1L             |     |                  |         | RR         |                |              |        |\n+------+-----------------+-----+------------------+---------+------------+----------------+--------------+--------+\n| 90H+ |                 |     |                  |         | SSG-EG     |                |              |        |\n+------+-----------------+-----+------------------+---------+------------+----------------+--------------+--------+\n|      |                 |     |                  |         |            |                |              |        |\n+------+-----------------+-----+------------------+---------+------------+----------------+--------------+--------+\n| A0H+ | Freq. LSB       |     |                  |         |            |                |              |        |\n+------+-----------------+-----+------------------+---------+------------+----------------+--------------+--------+\n| A4H+ |                 |     | Block            |         |            | Freq. MSB      |              |        |\n+------+-----------------+-----+------------------+---------+------------+----------------+--------------+--------+\n| A8H+ | Ch3 suppl. freq.|     |                  |         |            |                |              |        |\n+------+-----------------+-----+------------------+---------+------------+----------------+--------------+--------+\n| ACH+ |                 |     | Ch3 suppl. block |         |            | Ch3 suppl freq |              |        |\n+------+-----------------+-----+------------------+---------+------------+----------------+--------------+--------+\n| B0H+ |                 |     | Feedback         |         |            | Algorithm      |              |        |\n+------+-----------------+-----+------------------+---------+------------+----------------+--------------+--------+\n| B4H+ | L               | R   | AMS              |         |            | FMS            |              |        |\n+------+-----------------+-----+------------------+---------+------------+----------------+--------------+--------+\n\n\n*/\n","import React from \"react\"\nimport {emptyParams, emptyMapping} from \"./utils/patches-utils\"\nimport Emulator from './utils/emulator'\nimport {reactLocalStorage} from 'reactjs-localstorage'\n\nexport const CV2612Context = React.createContext()\nexport const CV2612Consumer = CV2612Context.Consumer\n\nconst ctrlmap = ['ar','d1','sl','d2','rr','tl','mul','det','rs','am','al','fb','ams','fms','st','lfo']\n\n// Create the provider using a traditional React.Component class\nclass CV2612Provider extends React.Component {\n\n  constructor(props){\n    super(props);\n\n    this.state = {\n      midi: null,\n      emulator: new Emulator(),\n      learning: false,\n      activeParameter: null,\n      envelopes: {},\n      params: emptyParams(),\n      mapping: emptyMapping(),\n      filters:{ch: 6},\n      soundOn: false,\n      setActiveParameter: this.setActiveParameter,\n      updateParam: this.updateParam,\n      updateParams: this.updateParams,\n      filterChannel: this.filterChannel,\n      toggleSound: this.toggleSound,\n      toggleLearning: this.toggleLearning,\n      handleCC: this.handleCC,\n    }\n  }\n\n  componentDidMount(){\n    const mapping = reactLocalStorage.getObject('mapping',null)\n    if(mapping!==null)\n      this.setState({mapping:mapping})\n  }\n\n  componentWillUnmount() {\n    this.state.emulator.destroy()\n  }\n\n  handleCC = (ch,cc, val)=>{\n    const k = this.state.activeParameter\n    if(this.state.mapping[k] && this.state.learning){\n      let mapping = {...this.state.mapping}\n      if(mapping[k].ch !== ch && mapping[k].cc !== cc){\n        mapping[k].ch = ch\n        mapping[k].cc = cc\n        this.setState({mapping: mapping})\n        reactLocalStorage.setObject('mapping',mapping)\n      }\n    }\n\n    for (let [k, m] of Object.entries(this.state.mapping)) {\n      if(m.cc === cc && m.ch === ch){\n        const resolution = Math.pow(2,m.bits)\n        const step = 128/resolution\n        const v = Math.floor(val/step)\n        this.updateParam(k,v)\n      }\n    }\n\n  }\n\n  toggleLearning = () =>{\n    this.setState({learning: !this.state.learning})\n  }\n\n\n  toggleSound = () =>{\n    if(this.state.soundOn){\n      this.state.emulator.pause()\n    }else{\n      this.state.emulator.play()\n    }\n    this.setState({soundOn: !this.state.soundOn})\n  }\n\n\n  //todo: should be internal only\n  sendParameter = (code, value) => {\n    const parts = code.split('_')\n    const ch = parseInt(parts[0])\n    const op = parseInt(parts[1])\n    const param = parts[2]\n    // send data header\n    const addr = []\n    // part 6 is a three bytes address\n    // 6 will be a omni or non channel message\n    addr.push(ch)\n    // 4 will be a omni or non operator message\n    addr.push(op)\n    // ctrl name  to 7-bit number\n    addr.push(ctrlmap.indexOf(param))\n    this.state.midi.sendSysexSet(addr,value)\n    this.state.emulator.update(ch,op,param,value,this.state.params)\n  }\n\n  setActiveParameter = (param) => {\n    this.setState({activeParameter: param})\n  }\n\n\n  updateParam = (code,value) => {\n    let params = {...this.state.params}\n    if(params[code] !== value){\n      params[code] = value\n      this.setState({params: params})\n      this.sendParameter(code,value)\n    }\n  }\n\n  updateParams = (params) => {\n    this.setState({params: params})\n\n    for (let [k, v] of Object.entries(params)) {\n      this.sendParameter(k,v)\n    }\n\n  }\n\n  filterChannel= (ch) => {\n    let filters = {...this.state.filters}\n    filters.ch = ch\n    this.setState({filters})\n  }\n\n\n\n  componentDidUpdate(prevProps, prevState) {\n    const p1 = prevState.params\n    const p2 = this.state.params\n    const env_params = ['ar','d1','sl','d2','rr','tl']\n\n    //which params have changed?\n    const diff = Object.keys(p2).reduce((diff, key) => {\n      if (p1[key] === p2[key]) return diff\n      return {\n        ...diff,\n        [key]: p2[key]\n      }\n    }, {})\n\n    //check if any envelope should change\n    const envs = Object.keys(diff).reduce((acc, key) => {\n      if (env_params.some((a) => key.endsWith(a)))\n        //accumulates channel_operator to identify envelope to update\n        acc.push(key.substring(0,3))\n      return acc\n    }, [])\n      .filter((x, i, a) => a.indexOf(x) === i) //filter unique\n\n    //update envelopes?\n    if(envs.length){\n      let envelopes = {...this.state.envelopes}\n      envs.forEach( (e) => {\n        const env = env_params\n          .reduce((acc,i)=>{acc[`${i}`]=p2[`${e}_${i}`];return acc},{})\n        envelopes[e] = this.calculateEnvelopePoints(env)\n      })\n      this.setState({envelopes: envelopes})\n    }\n\n\n  }\n\n  calculateEnvelopePoints(env){\n    const x1 = Math.round((31-env.ar)/31*100)\n    const y1 = Math.round(env.tl/127*100)\n    const x2 = Math.round(x1+(31-env.d1)/31*100)\n    const y2 = Math.round(y1+(100-y1)*(env.sl/15))\n    const x3 = Math.round(x2+(31-env.d2)/31*50+50)\n    const y3 = Math.round(y2+(100-y2)*(0.5*(env.d2/31)))\n    const x4 = Math.round(x3+(31-env.rr)/31*100)\n\n    const points = [\n        [0,100],\n        [x1,y1],\n        [x2,y2],\n        [x3,y3],\n        [x4,100]\n      ]\n    return points.map((p)=>p.join(',')).join(' ').replace(/NaN/g,'0')\n  }\n\n\n  render () {\n    return (\n      // value prop is where we define what values\n      // that are accessible to consumer components\n       <CV2612Context.Provider value={this.state}>\n        {this.props.children}\n      </CV2612Context.Provider>\n    )\n  }\n}\n\nexport default CV2612Provider\n","import React from 'react'\nimport {CV2612Context} from \"./context\"\nimport {emptyMapping} from \"./utils/patches-utils\"\nimport {reactLocalStorage} from 'reactjs-localstorage'\nimport { FaSlidersH,\n         FaTrash,\n         FaGhost,\n         FaVolume,\n         FaVolumeSlash\n        } from 'react-icons/fa'\n\n\n//todo: move midi stuff to midi-utils.js\n//warning: this component cannot be unmounted\nclass Midi extends React.Component {\n  static contextType = CV2612Context\n\n  midiInId = ''\n  midiOutId = ''\n  midiAccess= null\n\n  constructor(props) {\n    super(props)\n    this.state = {\n      midiIns: [],\n      midiOuts: [],\n      lastMsg: '',\n    }\n\n  }\n\n  componentDidMount(){\n    navigator.requestMIDIAccess( { sysex: true }).then(\n      (ma)=>{\n        this.midiAccess = ma\n        this.refreshMidiPorts()\n        ma.onstatechange = this.onMIDIStateChange\n      },()=>console.log('Could not access your MIDI devices.'))\n\n    this.context.midi = this\n  }\n\n\n  onChangeMidiIn = (ev) => {\n    this.setMidiIn(ev.target.value)\n  }\n\n  onChangeMidiOut = (ev) => {\n    this.setMidiOut(ev.target.value)\n  }\n\n  setMidiOut(id){\n    this.midiOutId = id\n    this.setState({midiOutId: id})\n    reactLocalStorage.set('midiOutId',id)\n    this.sendHandshake()\n  }\n\n  setMidiIn(id){\n    this.midiInId = id\n    this.setState({midiInId: id})\n    reactLocalStorage.set('midiInId',id)\n    const midiIn = this.midiAccess.inputs.get(id)\n    if(midiIn){\n      midiIn.onmidimessage = this.onMIDIMessage\n    }else{\n      console.log('Midi In error')\n    }\n  }\n\n  sendHandshake(){\n    // device ID request\n    const msg = [0xF0, 0x7E, 0x7F, 0x06, 0x01, 0xF7]\n    this.sendSysex(msg)\n\n  }\n\n  sendSysex = (data) => {\n    this.sendMidi(data)\n  }\n\n  sendSysexSet = (addr,value) => {\n    // send data header\n    const msg = [0xF0, 0x41, 0x26, 0x12, 0x12]\n    // part 6 is a three bytes address\n    // part 7 is the data itself, in this case, a single 7-bit\n    // part 8 is the cheksum , 0x7F - the sum of address and value\n    const chksum = 0x7F - ((addr[0]+addr[1]+addr[2]+value)%0x7F)\n    msg.push(addr[0])\n    msg.push(addr[1])\n    msg.push(addr[2])\n    msg.push(value)\n    msg.push(chksum)\n    // part 9  is the end byte\n    msg.push(0xF7)\n    this.sendSysex(msg)\n  }\n\n  sendMidi = (data) => {\n    const ma = this.midiAccess\n    if(ma===null){\n      console.log('Null midi Access')\n      return\n    }\n    const midiOut = ma.outputs.get(this.midiOutId)\n    if(midiOut){\n      midiOut.send(data)\n    }else{\n      console.log('No Midi Out')\n    }\n  }\n\n  onMIDIStateChange = (e) => {\n    // Print information about the (dis)connected MIDI controller\n    console.log(e.port.name, e.port.manufacturer, e.port.state, e.port.type)\n    this.refreshMidiPorts()\n  }\n\n  refreshMidiPorts() {\n    const ma = this.midiAccess\n    const inputs = Array.from(ma.inputs.values())\n    const outputs = Array.from(ma.outputs.values())\n    this.setState({midiIns:inputs, midiOuts:outputs})\n\n    if(inputs.length){\n      let id = reactLocalStorage.get('midiInId')\n      // is last id still available??\n      if( !inputs.map(i=>i.id).includes(id) ){\n        id = inputs[0].id\n      }\n      if(id !== this.midiInId)\n        this.setMidiIn(id)\n    }\n    if(outputs.length){\n      let id = reactLocalStorage.get('midiOutId')\n      // is last id still available??\n      if( !outputs.map(o=>o.id).includes(id) ){\n        id = outputs[0].id\n      }\n      if(id !== this.midiOutId)\n        this.setMidiOut(id)\n    }\n  }\n\n  onMIDIMessage = (msg) => {\n\n    if(msg.target.id !== this.midiInId)\n      return\n\n    const data = Array.from(msg.data)\n    const type = data[0] & 0xf0\n\n    if(type===0xF0){ // sysex\n      const idReply = [0xF0, 0x7E, 0x00, 0x06, 0x02,  //identity reply\n          0x26, 0x26, 0x12, 0x00, 0x00, // ID - family code - model number\n          0x01, 0x00, 0x00, 0x00, 0xF7] //version - end\n      if(JSON.stringify(data) === JSON.stringify(idReply)){\n        this.setState({lastMsg: `CV2612 found!` })\n      }\n      return\n    }\n\n    if(type === 0xB0){\n      const ch = data[0] & 0x0f\n      const cc = data[1] & 0x7f\n      const val = data[2] & 0x7f\n      this.context.handleCC(ch,cc, val)\n      this.setState({lastMsg: `${type},${ch},${cc},${val}` })\n    }\n\n    // resend noteon/off events\n    if(type === 0x80 || type === 0x90){\n      this.sendMidi(data)\n      if(type === 0x90){\n        this.context.emulator.noteOn(data[1])\n      }else{\n        this.context.emulator.noteOff(data[1])\n      }\n    }\n\n  }\n\n  onLearnClick = (e) => {\n    e.preventDefault()\n    this.context.toggleLearning()\n  }\n\n  onPanicClick = (e) => {\n    e.preventDefault()\n    this.context.midi.sendSysexSet([0x06,0x04,0x10],0x00)\n  }\n\n  onClearClick = (e) => {\n    e.preventDefault()\n    this.context.midi.sendSysexSet([0x06,0x04,0x11],0x00)\n  }\n\n  //the navigation here came handy...\n  onToggleSoundClick = (e) => {\n    e.preventDefault()\n    this.context.toggleSound()\n  }\n\n  render() {\n    return (\n      <div>\n        <p>\n          {this.state.lastMsg ||'Click learn to bind a controller'}\n        </p>\n        <nav className=\"midi\">\n          <span>In</span>\n          <select value={this.state.midiInId} onChange={this.onChangeMidiIn}>\n            {this.state.midiIns.map((i) =><option key={i.id} value={i.id}>{i.name}</option>)}\n          </select>\n          <span>Out</span>\n          <select value={this.state.midiOutId} onChange={this.onChangeMidiOut}>\n            {this.state.midiOuts.map((o) =><option key={o.id} value={o.id}>{o.name}</option>)}\n          </select>\n          <a className={this.context.learning ? 'learning':''} href=\"/\" title=\"Click to Learn\" onClick={this.onLearnClick}><FaSlidersH/></a>\n          <a href=\"/\" title=\"Click if panic\" onClick={this.onPanicClick}><FaGhost/></a>\n          <a href=\"/\" title=\"Click to clear midi mapping\" onClick={this.onClearClick}><FaTrash/></a>\n          <a href=\"/\" title=\"Toggles Sound\" onClick={this.onToggleSoundClick}>{this.context.soundOn ?<FaVolume/>:<FaVolumeSlash/>}</a>\n        </nav>\n      </div>\n    )\n  }\n}\n\nexport default Midi;\n","import React from 'react'\nimport {CV2612Context} from \"./context\"\n\nlet seqTimeOut\nlet seqNote = 0\nlet seqNoteOn = false\n\nclass Sequencer extends React.Component {\n  static contextType = CV2612Context\n\n  constructor(props){\n    super(props);\n    this.state = {\n      sequencerOn: false,\n    }\n  }\n\n  componentWillUnmount() {\n    this.sequencerStop()\n  }\n\n\n  onClick = (e) => {\n    e.preventDefault()\n    this.setState({sequencerOn: !this.state.sequencerOn})\n  }\n\n  sequencerStop() {\n    clearTimeout(seqTimeOut)\n    if(seqNoteOn){\n      this.context.midi.sendMidi([0x80,seqNote,0x00])\n      seqNoteOn = false\n    }\n  }\n\n  sequencerTick() {\n    if(seqNoteOn){\n      this.context.midi.sendMidi([0x80,seqNote,0x00])\n      seqNoteOn = false\n    }\n    else{\n      //sets a random note\n      seqNote = [0,3,5,7,10].sort(() => Math.random() - 0.5)[0]\n                     + (3+Math.floor(Math.random()*5))*12\n      this.context.midi.sendMidi([0x90,seqNote,100])\n      seqNoteOn = true\n    }\n\n    if(this.state.sequencerOn){\n      const duration = 500/Math.pow(2,Math.floor(Math.random()*5))\n      seqTimeOut = setTimeout(()=> this.sequencerTick(), duration)\n    }\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if(prevState.sequencerOn !== this.state.sequencerOn){\n      if(this.state.sequencerOn){\n        this.sequencerTick()\n      }else{\n        this.sequencerStop()\n      }\n    }\n  }\n\n  render() {\n    //todo: fixme\n    return null\n    return (\n      <button onClick={this.onClick}>{this.state.sequencerOn ? 'Stop Seq':'Start Seq'}</button>\n    )\n  }\n}\n\n\nexport default Sequencer\n","import React from 'react'\nimport {CV2612Context} from \"./context\"\nimport {dmp2patch, emptyParams} from \"./utils/patches-utils\"\n\nimport {reactLocalStorage} from 'reactjs-localstorage'\nimport { FaPlus,\n         FaBackspace,\n         FaCaretLeft,\n         FaCaretRight,\n         FaBomb,\n         FaSave,\n         FaUpload\n        } from 'react-icons/fa'\n\n\nclass Patches extends React.Component {\n  static contextType = CV2612Context\n\n  constructor(props){\n    super(props)\n    this.state = {\n      patches: [{name: 'empty', params: emptyParams()}],\n      current: 0,\n    }\n  }\n\n  componentDidMount(){\n    return\n    const patches = reactLocalStorage.getObject('patches',[])\n    if(patches.length===0){\n      this.loadDefaultPatches()\n    }else{\n      this.setState({patches:patches})\n    }\n  }\n\n  save(patches){\n    reactLocalStorage.setObject('patches',patches)\n    this.setState({patches:patches})\n  }\n\n  loadDefaultPatches(){\n    //empty previous patches\n    this.save([])\n\n    const r = new XMLHttpRequest()\n    r.onreadystatechange = (ev) => {\n      if(r.readyState === 4 && r.status === 200) {\n        const insts = r.responseText.split(/\\r?\\n/).filter( x => x.length>1)\n        for(const i of insts){\n          const r = new XMLHttpRequest()\n          r.responseType = 'arraybuffer'\n          r.onreadystatechange = (ev) => {\n            if(r.readyState === 4 && r.status === 200) {\n              const d = new Int8Array(r.response)\n              this.addDmpPatch(i,d)\n            }\n          }\n          r.open('GET',encodeURI(`/cv2612/instruments/${i}`))\n          r.send(null)\n        }\n      }\n    }\n    r.open('GET', '/cv2612/instruments/index.txt')\n    r.send(null)\n  }\n\n  //todo: load to all voices or current voice\n  componentDidUpdate(prevProps, prevState) {\n    //fixme: if i delete a patch, current doesnt change...\n    if(prevState.current !== this.state.current){\n      const i = parseInt(this.state.current)\n      const patch = this.state.patches[i]\n      if(patch)\n        this.context.updateParams(patch.params)\n    }\n\n    if(prevState.patches.length !== this.state.patches.length){\n      this.setState({current:0})\n      const patch = this.state.patches[0]\n      if(patch)\n        this.context.updateParams(patch.params)\n    }\n\n  }\n\n\n  addDmpPatch = (name, d) => {\n    const patch = dmp2patch(name,d)\n    if(patch !== null){\n      //is there any risk here?\n      const patches = this.state.patches\n      patches.push(patch)\n      this.save(patches)\n    }\n  }\n\n  onChangeHandler = (ev) => {\n    for(const f of ev.target.files){\n      const fr = new FileReader()\n      fr.onload = () =>{\n        const d = new Int8Array(fr.result)\n        this.addDmpPatch(f.name,d)\n      }\n      fr.readAsArrayBuffer(f)\n    }\n  }\n\n  onChange = (ev) => {\n    this.setState({current: ev.target.value})\n  }\n\n  onSave = (e) => {\n    e.preventDefault()\n    if(this.state.patches.length===0)\n      return\n\n    const patches = this.state.patches\n    const i = parseInt(this.state.current)\n    patches[i].params = this.context.params\n    this.save(patches)\n\n  }\n\n  onCreate = (e) => {\n    e.preventDefault()\n    let patch = prompt(\"Name your patch\")\n    if (patch !== null && patch !== \"\") {\n      const patches = this.state.patches\n      patches.push({name:patch, params: this.context.params})\n      this.save(patches)\n    }\n  }\n\n  onDelete = (e) => {\n    e.preventDefault()\n    if(this.state.patches.length<=1)\n      return\n\n    const patches = this.state.patches.filter( (p,i) => i!==parseInt(this.state.current))\n    this.save(patches)\n  }\n\n  onLoadDefaults = (e) => {\n    e.preventDefault()\n    this.loadDefaultPatches()\n  }\n\n  onLeftClick = (e) => {\n    e.preventDefault()\n    const i = parseInt(this.state.current)\n    if(i>0){\n      this.setState({current:i-1})\n    }\n  }\n\n  onRightClick = (e) => {\n    e.preventDefault()\n    const i = parseInt(this.state.current)\n    if(i<this.state.patches.length-1){\n      this.setState({current:i+1})\n    }\n  }\n\n  onUploadClick = (e) => {\n    e.preventDefault()\n    this.refs.file.click()\n  }\n\n  render() {\n    return (\n      <nav>\n        <a href=\"/\" title=\"Previous Patch\" onClick={this.onLeftClick}><FaCaretLeft/></a>\n        <select value={this.state.current} onChange={this.onChange}>\n          {this.state.patches.map((p,i) =><option key={i} value={i}>{p.name}</option>)}\n        </select>\n        <a href=\"/\" title=\"Next Patch\" onClick={this.onRightClick}><FaCaretRight/></a>\n        <a href=\"/\" title=\"Save this Patch\" onClick={this.onSave}><FaSave/></a>\n        <a href=\"/\" title=\"Create new Patch\" onClick={this.onCreate}><FaPlus/></a>\n        <a href=\"/\" title=\"Upload Patches\" onClick={this.onUploadClick}><FaUpload/></a>\n        <a href=\"/\" title=\"Delete this Patch\" onClick={this.onDelete}><FaBackspace/></a>\n        <a href=\"/\" title=\"Load default Patches\" onClick={this.onLoadDefaults}><FaBomb/></a>\n        <input style={{display:'none'}} ref=\"file\" type=\"file\" accept=\".dmp\" multiple onChange={this.onChangeHandler} / >\n\n      </nav>\n    )\n  }\n}\n\n\nexport default Patches;\n","import React from 'react'\nimport {CV2612Context} from \"./context\"\n\nclass Envelope extends React.Component {\n  static contextType = CV2612Context\n  constructor(props) {\n    super(props)\n    this.state = {}\n    this.code = `${props.ch}_${props.op}`\n  }\n\n  render() {\n    return (\n      <div className=\"envelope\">\n        <svg height=\"100\" width=\"400\" viewBox=\"0 0 400 100\" xmlns=\"http://www.w3.org/2000/svg\">\n          <polyline points={this.context.envelopes[this.code]} />\n        </svg>\n      </div>\n    )\n  }\n}\n\nEnvelope.defaultProps = {\n  ch: 6,\n  op: 4\n};\n\n\nexport default Envelope;\n","import React from 'react'\nimport {CV2612Context} from \"./context\"\n\nclass Slider extends React.Component {\n  static contextType = CV2612Context\n  constructor(props) {\n    super(props)\n    this.code = `${props.ch}_${props.op}_${props.name}`\n    this.state = {}\n  }\n\n  componentWillMount(){\n    const map =this.context.mapping[this.code]\n    this.max = Math.pow(2,map.bits)-1\n  }\n\n  onChange = (ev) =>{\n    ev.preventDefault()\n    this.context.updateParam(this.code,parseInt(ev.target.value))\n    this.context.setActiveParameter(this.code)\n  }\n\n  onClick = (ev) =>{\n    ev.preventDefault()\n    this.context.setActiveParameter(this.code)\n  }\n\n  render() {\n    const m = this.context.mapping[this.code]\n    console.log(this.context)\n    if(!m) return null\n\n    const mapped = ( (m.ch && m.cc)!==null)\n    let className = 'slider'\n    if(this.context.learning) className += ' learn'\n    if(this.context.activeParameter === this.code) className += ' active'\n    if(mapped) className += ' mapped'\n\n    return (\n      <div className={className} onClick={this.onClick} >\n        <label>{this.props.name}</label>\n        <input type=\"range\" step={1} min={0} max={this.max} value={this.context.params[this.code]}\n         onChange={this.onChange} />\n        <span>\n          {this.context.params[this.code] + (this.context.learning ? (mapped ? ` - ${m.ch}:${m.cc}` : ' - n/a'): '') }\n        </span>\n      </div>\n    )\n  }\n}\n\nSlider.defaultProps = {\n  env: false,\n  ch: 6,\n  op: 4\n}\n\nexport default Slider\n","import React from 'react'\nimport Envelope from \"./envelope\"\nimport Slider from \"./slider\"\nimport {CV2612Context} from \"./context\"\n\nclass Operator extends React.Component {\n  static contextType = CV2612Context\n\n  render() {\n    return (\n      <div className=\"operator\">\n        <h5>Op {this.props.op+1}</h5>\n        <Slider name=\"ar\" ch={this.props.ch} op={this.props.op} />\n        <Slider name=\"d1\" ch={this.props.ch} op={this.props.op} />\n        <Slider name=\"sl\" ch={this.props.ch} op={this.props.op} />\n        <Slider name=\"d2\" ch={this.props.ch} op={this.props.op} />\n        <Slider name=\"rr\" ch={this.props.ch} op={this.props.op} />\n        <Slider name=\"tl\" ch={this.props.ch} op={this.props.op} />\n        <Envelope ch={this.props.ch} op={this.props.op} />\n        <Slider name=\"mul\" ch={this.props.ch} op={this.props.op} />\n        <Slider name=\"det\" ch={this.props.ch} op={this.props.op} />\n        <Slider name=\"rs\" ch={this.props.ch} op={this.props.op} />\n        <Slider name=\"am\" ch={this.props.ch} op={this.props.op} />\n      </div>\n    )\n  }\n}\n\n\nOperator.defaultProps = {\n  ch: 6\n};\n\n\nexport default Operator;\n","import React from 'react'\nimport Operator from \"./operator\"\nimport Slider from \"./slider\"\nimport {CV2612Context} from \"./context\"\nimport algorithmAscii from \"./utils/algorithmAscii\"\n\nclass Channel extends React.Component {\n  static contextType = CV2612Context\n\n  render() {\n    return (\n      <div className=\"channel\">\n        <table>\n          <tbody>\n            <tr>\n              <td><Slider name=\"lfo\" /></td>\n              <td></td>\n              <td><Slider name=\"al\" ch={this.props.ch} /></td>\n              <td>\n                <pre className=\"algorithm\">\n                  {algorithmAscii(this.context.params[`${this.props.ch}_4_al`])}\n                </pre>\n              </td>\n            </tr>\n            <tr>\n              <td><Slider name=\"fb\"  ch={this.props.ch} /></td>\n              <td><Slider name=\"ams\" ch={this.props.ch} /></td>\n              <td><Slider name=\"fms\" ch={this.props.ch} /></td>\n              <td><Slider name=\"st\"  ch={this.props.ch} /></td>\n              <td></td>\n            </tr>\n            <tr>\n              <td><Operator ch={this.props.ch} op={0} /></td>\n              <td><Operator ch={this.props.ch} op={1} /></td>\n              <td><Operator ch={this.props.ch} op={2} /></td>\n              <td><Operator ch={this.props.ch} op={3} /></td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n    )\n  }\n}\n\nChannel.defaultProps = {\n  ch: 6\n}\n\nexport default Channel\n","export default function algorithmAscii(algorithm){\n  switch(algorithm) {\n    case 0:\n      return `\n\n\n\n╔═╗ ╔═╗ ╔═╗ ╔═╗\n║1╠═╣2╠═╣3╠═╣4╠══\n╚═╝ ╚═╝ ╚═╝ ╚═╝\n\n\n\n`\n    case 1:\n    return `\n\n╔═╗\n║1╠═╗\n╚═╝ ║  ╔═╗  ╔═╗\n    ╠══╣3╠══╣4╠══\n╔═╗ ║  ╚═╝  ╚═╝\n║2╠═╝\n╚═╝\n\n`\n    case 2:\n    return `\n\n     ╔═╗\n     ║1╠═╗\n     ╚═╝ ║  ╔═╗\n         ╠══╣4╠══\n╔═╗  ╔═╗ ║  ╚═╝\n║2╠══╣3╠═╝\n╚═╝  ╚═╝\n\n`\n    case 3:\n    return `\n\n╔═╗  ╔═╗\n║1╠══╣2╠═╗\n╚═╝  ╚═╝ ║  ╔═╗\n         ╠══╣4╠══\n     ╔═╗ ║  ╚═╝\n     ║3╠═╝\n     ╚═╝\n\n`\n    case 4:\n    return `\n\n╔═╗  ╔═╗\n║1╠══╣2╠═╗\n╚═╝  ╚═╝ ║\n         ╠══\n╔═╗  ╔═╗ ║\n║3╠══╣4╠═╝\n╚═╝  ╚═╝\n\n`\n    case 5:\n    return `\n      ╔═╗\n    ╔═╣2╠══╗\n    ║ ╚═╝  ║\n╔═╗ ║ ╔═╗  ║\n║1╠═╬═╣3╠══╬══\n╚═╝ ║ ╚═╝  ║\n    ║ ╔═╗  ║\n    ╚═╣4╠══╝\n      ╚═╝\n`\n    case 6:\n    return `\n ╔═╗  ╔═╗\n ║1╠══╣2╠══╗\n ╚═╝  ╚═╝  ║\n      ╔═╗  ║\n      ║3╠══╬══\n      ╚═╝  ║\n      ╔═╗  ║\n      ║4╠══╝\n      ╚═╝\n`\n    case 7:\n    return `\n\n\n╔═╗ ╔═╗ ╔═╗ ╔═╗\n║1║ ║2║ ║3║ ║4║\n╚╦╝ ╚╦╝ ╚╦╝ ╚╦╝\n ╚═══╩═╦═╩═══╝\n       ║\n       ╚══\n\n`\n  default:\n      return 'no algorithm'\n  }\n}\n","import React from 'react'\nimport {CV2612Context} from \"./context\"\nimport Channel from \"./channel\"\n\nclass Channels extends React.Component {\n  static contextType = CV2612Context\n\n  onFilterChannel= (ev) => {\n    ev.preventDefault()\n    const ch = parseInt(ev.target.attributes.ch.value)\n    this.context.filterChannel(ch)\n  }\n\n  render() {\n    const f = this.context.filters\n    return (\n        <>\n          <nav>\n            <a href=\"/\" className={f.ch === 6 ? 'active':'' } ch={6} onClick={this.onFilterChannel} title=\"Show only Omni channel\">Omni Channel</a>\n            {[0,1,2,3,4,5].map(i => <a href=\"/\" className={f.ch === i ? 'active':'' } key={i} ch={i} onClick={this.onFilterChannel} title={\"Show only channel \"+(i+1)}>{i+1}</a>)}\n          </nav>\n          {[0,1,2,3,4,5,6].map(i => (f.ch === i) && <Channel key={i} ch={i} />)}\n        </>\n    )\n  }\n\n}\n\nexport default Channels\n","\nimport React from \"react\"\nimport CV2612Provider from \"./context\"\nimport Midi from \"./midi\"\nimport Sequencer from \"./sequencer\"\nimport Patches from \"./patches\"\nimport Channels from \"./channels\"\n\nclass Device extends React.Component {\n\n  render() {\n    return (\n        <CV2612Provider>\n          <Midi />\n          <Sequencer />\n          <Patches />\n          <Channels />\n        </CV2612Provider>\n    )\n  }\n}\n\nexport default Device\n","import React from \"react\"\nimport Layout from \"../layouts/cv2612\"\nimport SEO from \"../components/seo\"\nimport Device from \"../components/cv2612/device\"\n\n\nclass CV2612Index extends React.Component {\n  render() {\n    return (\n      <Layout location={this.props.location} >\n        <SEO title=\"cv2612\" />\n        <Device />\n      </Layout>\n    )\n  }\n}\n\nexport default CV2612Index\n","import React from \"react\"\nimport PropTypes from \"prop-types\"\nimport Link, {\n  withPrefix,\n  withAssetPrefix,\n  navigate,\n  push,\n  replace,\n  navigateTo,\n  parsePath,\n} from \"gatsby-link\"\nimport PageRenderer from \"./public-page-renderer\"\n\nconst StaticQueryContext = React.createContext({})\n\nconst StaticQuery = props => (\n  <StaticQueryContext.Consumer>\n    {staticQueryData => {\n      if (\n        props.data ||\n        (staticQueryData[props.query] && staticQueryData[props.query].data)\n      ) {\n        return (props.render || props.children)(\n          props.data ? props.data.data : staticQueryData[props.query].data\n        )\n      } else {\n        return <div>Loading (StaticQuery)</div>\n      }\n    }}\n  </StaticQueryContext.Consumer>\n)\n\nconst useStaticQuery = query => {\n  if (\n    typeof React.useContext !== `function` &&\n    process.env.NODE_ENV === `development`\n  ) {\n    throw new Error(\n      `You're likely using a version of React that doesn't support Hooks\\n` +\n        `Please update React and ReactDOM to 16.8.0 or later to use the useStaticQuery hook.`\n    )\n  }\n  const context = React.useContext(StaticQueryContext)\n  if (context[query] && context[query].data) {\n    return context[query].data\n  } else {\n    throw new Error(\n      `The result of this StaticQuery could not be fetched.\\n\\n` +\n        `This is likely a bug in Gatsby and if refreshing the page does not fix it, ` +\n        `please open an issue in https://github.com/gatsbyjs/gatsby/issues`\n    )\n  }\n}\n\nStaticQuery.propTypes = {\n  data: PropTypes.object,\n  query: PropTypes.string.isRequired,\n  render: PropTypes.func,\n  children: PropTypes.func,\n}\n\nfunction graphql() {\n  throw new Error(\n    `It appears like Gatsby is misconfigured. Gatsby related \\`graphql\\` calls ` +\n      `are supposed to only be evaluated at compile time, and then compiled away. ` +\n      `Unfortunately, something went wrong and the query was left in the compiled code.\\n\\n` +\n      `Unless your site has a complex or custom babel/Gatsby configuration this is likely a bug in Gatsby.`\n  )\n}\n\nexport {\n  Link,\n  withAssetPrefix,\n  withPrefix,\n  graphql,\n  parsePath,\n  navigate,\n  push, // TODO replace for v3\n  replace, // TODO remove replace for v3\n  navigateTo, // TODO: remove navigateTo for v3\n  StaticQueryContext,\n  StaticQuery,\n  PageRenderer,\n  useStaticQuery,\n}\n","const preferDefault = m => (m && m.default) || m\n\nif (process.env.BUILD_STAGE === `develop`) {\n  module.exports = preferDefault(require(`./public-page-renderer-dev`))\n} else if (process.env.BUILD_STAGE === `build-javascript`) {\n  module.exports = preferDefault(require(`./public-page-renderer-prod`))\n} else {\n  module.exports = () => null\n}\n","import React from \"react\"\nimport PropTypes from \"prop-types\"\nimport Helmet from \"react-helmet\"\nimport { StaticQuery, graphql } from \"gatsby\"\n\nfunction SEO({ description, lang, meta, keywords, title }) {\n  return (\n    <StaticQuery\n      query={detailsQuery}\n      render={data => {\n        const metaDescription =\n          description || data.site.siteMetadata.description\n        return (\n          <Helmet\n            htmlAttributes={{\n              lang,\n            }}\n            title={title}\n            titleTemplate={`%s | ${data.site.siteMetadata.title}`}\n            meta={[\n              {\n                name: `description`,\n                content: metaDescription,\n              },\n              {\n                property: `og:title`,\n                content: title,\n              },\n              {\n                property: `og:description`,\n                content: metaDescription,\n              },\n              {\n                property: `og:type`,\n                content: `website`,\n              },\n              {\n                name: `twitter:card`,\n                content: `summary`,\n              },\n              {\n                name: `twitter:creator`,\n                content: data.site.siteMetadata.author,\n              },\n              {\n                name: `twitter:title`,\n                content: title,\n              },\n              {\n                name: `twitter:description`,\n                content: metaDescription,\n              },\n            ]\n              .concat(\n                keywords.length > 0\n                  ? {\n                      name: `keywords`,\n                      content: keywords.join(`, `),\n                    }\n                  : []\n              )\n              .concat(meta)}\n          />\n        )\n      }}\n    />\n  )\n}\n\nSEO.defaultProps = {\n  lang: `en`,\n  meta: [],\n  keywords: [],\n}\n\nSEO.propTypes = {\n  description: PropTypes.string,\n  lang: PropTypes.string,\n  meta: PropTypes.array,\n  keywords: PropTypes.arrayOf(PropTypes.string),\n  title: PropTypes.string.isRequired,\n}\n\nexport default SEO\n\nconst detailsQuery = graphql`\n  query DefaultSEOQuery {\n    site {\n      siteMetadata {\n        title\n        description\n        author\n      }\n    }\n  }\n`\n","import React from \"react\"\nimport PropTypes from \"prop-types\"\n\nimport InternalPageRenderer from \"./page-renderer\"\nimport loader from \"./loader\"\n\nconst ProdPageRenderer = ({ location }) => {\n  const pageResources = loader.getResourcesForPathnameSync(location.pathname)\n  if (!pageResources) {\n    return null\n  }\n\n  return React.createElement(InternalPageRenderer, {\n    location,\n    pageResources,\n    ...pageResources.json,\n  })\n}\n\nProdPageRenderer.propTypes = {\n  location: PropTypes.shape({\n    pathname: PropTypes.string.isRequired,\n  }).isRequired,\n}\n\nexport default ProdPageRenderer\n","import React from \"react\"\nimport { Link } from \"gatsby\"\nimport PropTypes from 'prop-types'\n\nconst swaps = [['i','1'],['e','3'],['o','0'],['g','6'],['a','4']]\n\nclass Brand extends React.Component {\n\n  constructor(props){\n    super(props)\n    this.state = {title: props.title}\n  }\n\n  getDiff(){\n    let diff = 0\n    for(let i=0;i<this.props.title.length;i++){\n      diff += (this.state.title[i]===this.props.title[i]) ? 0 : 1\n    }\n    return diff\n  }\n\n  timer() {\n    let i = Math.floor(Math.random()*swaps.length)\n    let from = Math.round(Math.random())\n    if(this.getDiff()>3) from = 1\n    let to = from ? 0 : 1\n    if(Math.random()<0.5){\n      this.setState({\n        title: this.state.title.replace(swaps[i][from],swaps[i][to])\n      })\n    }\n  }\n\n  componentDidMount(){\n    this.intervalId = setInterval(this.timer.bind(this), 100);\n  }\n\n  componentWillUnmount(){\n    clearInterval(this.intervalId);\n  }\n\n  render() {\n    return (\n        <h1>\n          <Link to={`/`}>{this.state.title}</Link>\n        </h1>\n    )\n  }\n\n}\n\n\n\nBrand.propTypes = {\n  title: PropTypes.string.isRequired,\n};\n\n\nexport default Brand\n"],"sourceRoot":""}